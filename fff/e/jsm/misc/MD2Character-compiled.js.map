{"version":3,"sources":["MD2Character.js"],"names":[],"mappings":"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","file":"MD2Character-compiled.js","sourcesContent":["/**\n * @author alteredq / http://alteredqualia.com/\n */\n\nimport {\n\tAnimationMixer,\n\tBox3,\n\tMesh,\n\tMeshLambertMaterial,\n\tObject3D,\n\tTextureLoader,\n\tUVMapping\n} from \"../../../build/three.module.js\";\nimport { MD2Loader } from \"../loaders/MD2Loader.js\";\n\nvar MD2Character = function () {\n\n\tvar scope = this;\n\n\tthis.scale = 1;\n\tthis.animationFPS = 6;\n\n\tthis.root = new Object3D();\n\n\tthis.meshBody = null;\n\tthis.meshWeapon = null;\n\n\tthis.skinsBody = [];\n\tthis.skinsWeapon = [];\n\n\tthis.weapons = [];\n\n\tthis.activeAnimation = null;\n\n\tthis.mixer = null;\n\n\tthis.onLoadComplete = function () {};\n\n\tthis.loadCounter = 0;\n\n\tthis.loadParts = function ( config ) {\n\n\t\tthis.loadCounter = config.weapons.length * 2 + config.skins.length + 1;\n\n\t\tvar weaponsTextures = [];\n\t\tfor ( var i = 0; i < config.weapons.length; i ++ ) weaponsTextures[ i ] = config.weapons[ i ][ 1 ];\n\t\t// SKINS\n\n\t\tthis.skinsBody = loadTextures( config.baseUrl + \"skins/\", config.skins );\n\t\tthis.skinsWeapon = loadTextures( config.baseUrl + \"skins/\", weaponsTextures );\n\n\t\t// BODY\n\n\t\tvar loader = new MD2Loader();\n\n\t\tloader.load( config.baseUrl + config.body, function ( geo ) {\n\n\t\t\tvar boundingBox = new Box3();\n\t\t\tboundingBox.setFromBufferAttribute( geo.attributes.position );\n\n\t\t\tscope.root.position.y = - scope.scale * boundingBox.min.y;\n\n\t\t\tvar mesh = createPart( geo, scope.skinsBody[ 0 ] );\n\t\t\tmesh.scale.set( scope.scale, scope.scale, scope.scale );\n\n\t\t\tscope.root.add( mesh );\n\n\t\t\tscope.meshBody = mesh;\n\n\t\t\tscope.meshBody.clipOffset = 0;\n\t\t\tscope.activeAnimationClipName = mesh.geometry.animations[ 0 ].name;\n\n\t\t\tscope.mixer = new AnimationMixer( mesh );\n\n\t\t\tcheckLoadingComplete();\n\n\t\t} );\n\n\t\t// WEAPONS\n\n\t\tvar generateCallback = function ( index, name ) {\n\n\t\t\treturn function ( geo ) {\n\n\t\t\t\tvar mesh = createPart( geo, scope.skinsWeapon[ index ] );\n\t\t\t\tmesh.scale.set( scope.scale, scope.scale, scope.scale );\n\t\t\t\tmesh.visible = false;\n\n\t\t\t\tmesh.name = name;\n\n\t\t\t\tscope.root.add( mesh );\n\n\t\t\t\tscope.weapons[ index ] = mesh;\n\t\t\t\tscope.meshWeapon = mesh;\n\n\t\t\t\tcheckLoadingComplete();\n\n\t\t\t};\n\n\t\t};\n\n\t\tfor ( var i = 0; i < config.weapons.length; i ++ ) {\n\n\t\t\tloader.load( config.baseUrl + config.weapons[ i ][ 0 ], generateCallback( i, config.weapons[ i ][ 0 ] ) );\n\n\t\t}\n\n\t};\n\n\tthis.setPlaybackRate = function ( rate ) {\n\n\t\tif ( rate !== 0 ) {\n\n\t\t\tthis.mixer.timeScale = 1 / rate;\n\n\t\t} else {\n\n\t\t\tthis.mixer.timeScale = 0;\n\n\t\t}\n\n\t};\n\n\tthis.setWireframe = function ( wireframeEnabled ) {\n\n\t\tif ( wireframeEnabled ) {\n\n\t\t\tif ( this.meshBody ) this.meshBody.material = this.meshBody.materialWireframe;\n\t\t\tif ( this.meshWeapon ) this.meshWeapon.material = this.meshWeapon.materialWireframe;\n\n\t\t} else {\n\n\t\t\tif ( this.meshBody ) this.meshBody.material = this.meshBody.materialTexture;\n\t\t\tif ( this.meshWeapon ) this.meshWeapon.material = this.meshWeapon.materialTexture;\n\n\t\t}\n\n\t};\n\n\tthis.setSkin = function ( index ) {\n\n\t\tif ( this.meshBody && this.meshBody.material.wireframe === false ) {\n\n\t\t\tthis.meshBody.material.map = this.skinsBody[ index ];\n\n\t\t}\n\n\t};\n\n\tthis.setWeapon = function ( index ) {\n\n\t\tfor ( var i = 0; i < this.weapons.length; i ++ ) this.weapons[ i ].visible = false;\n\n\t\tvar activeWeapon = this.weapons[ index ];\n\n\t\tif ( activeWeapon ) {\n\n\t\t\tactiveWeapon.visible = true;\n\t\t\tthis.meshWeapon = activeWeapon;\n\n\t\t\tscope.syncWeaponAnimation();\n\n\t\t}\n\n\t};\n\n\tthis.setAnimation = function ( clipName ) {\n\n\t\tif ( this.meshBody ) {\n\n\t\t\tif ( this.meshBody.activeAction ) {\n\n\t\t\t\tthis.meshBody.activeAction.stop();\n\t\t\t\tthis.meshBody.activeAction = null;\n\n\t\t\t}\n\n\t\t\tvar action = this.mixer.clipAction( clipName, this.meshBody );\n\n\t\t\tif ( action ) {\n\n\t\t\t\tthis.meshBody.activeAction = action.play();\n\n\t\t\t}\n\n\t\t}\n\n\t\tscope.activeClipName = clipName;\n\n\t\tscope.syncWeaponAnimation();\n\n\t};\n\n\tthis.syncWeaponAnimation = function () {\n\n\t\tvar clipName = scope.activeClipName;\n\n\t\tif ( scope.meshWeapon ) {\n\n\t\t\tif ( this.meshWeapon.activeAction ) {\n\n\t\t\t\tthis.meshWeapon.activeAction.stop();\n\t\t\t\tthis.meshWeapon.activeAction = null;\n\n\t\t\t}\n\n\t\t\tvar action = this.mixer.clipAction( clipName, this.meshWeapon );\n\n\t\t\tif ( action ) {\n\n\t\t\t\tthis.meshWeapon.activeAction = action.syncWith( this.meshBody.activeAction ).play();\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\tthis.update = function ( delta ) {\n\n\t\tif ( this.mixer ) this.mixer.update( delta );\n\n\t};\n\n\tfunction loadTextures( baseUrl, textureUrls ) {\n\n\t\tvar textureLoader = new TextureLoader();\n\t\tvar textures = [];\n\n\t\tfor ( var i = 0; i < textureUrls.length; i ++ ) {\n\n\t\t\ttextures[ i ] = textureLoader.load( baseUrl + textureUrls[ i ], checkLoadingComplete );\n\t\t\ttextures[ i ].mapping = UVMapping;\n\t\t\ttextures[ i ].name = textureUrls[ i ];\n\n\t\t}\n\n\t\treturn textures;\n\n\t}\n\n\tfunction createPart( geometry, skinMap ) {\n\n\t\tvar materialWireframe = new MeshLambertMaterial( { color: 0xffaa00, wireframe: true, morphTargets: true, morphNormals: true } );\n\t\tvar materialTexture = new MeshLambertMaterial( { color: 0xffffff, wireframe: false, map: skinMap, morphTargets: true, morphNormals: true } );\n\n\t\t//\n\n\t\tvar mesh = new Mesh( geometry, materialTexture );\n\t\tmesh.rotation.y = - Math.PI / 2;\n\n\t\tmesh.castShadow = true;\n\t\tmesh.receiveShadow = true;\n\n\t\t//\n\n\t\tmesh.materialTexture = materialTexture;\n\t\tmesh.materialWireframe = materialWireframe;\n\n\t\treturn mesh;\n\n\t}\n\n\tfunction checkLoadingComplete() {\n\n\t\tscope.loadCounter -= 1;\n\n\t\tif ( scope.loadCounter === 0 ) scope.onLoadComplete();\n\n\t}\n\n};\n\nexport { MD2Character };\n"]}