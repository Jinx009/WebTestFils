{"version":3,"sources":["TTFLoader.js"],"names":[],"mappings":"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","file":"TTFLoader-compiled.js","sourcesContent":["/**\n * @author gero3 / https://github.com/gero3\n * @author tentone / https://github.com/tentone\n * @author troy351 / https://github.com/troy351\n *\n * Requires opentype.js to be included in the project.\n * Loads TTF files and converts them into typeface JSON that can be used directly\n * to create THREE.Font objects.\n */\n\nimport {\n\tFileLoader,\n\tLoader\n} from \"../../../build/three.module.js\";\n\nvar TTFLoader = function ( manager ) {\n\n\tLoader.call( this, manager );\n\n\tthis.reversed = false;\n\n};\n\n\nTTFLoader.prototype = Object.assign( Object.create( Loader.prototype ), {\n\n\tconstructor: TTFLoader,\n\n\tload: function ( url, onLoad, onProgress, onError ) {\n\n\t\tvar scope = this;\n\n\t\tvar loader = new FileLoader( this.manager );\n\t\tloader.setPath( this.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.load( url, function ( buffer ) {\n\n\t\t\tonLoad( scope.parse( buffer ) );\n\n\t\t}, onProgress, onError );\n\n\t},\n\n\tparse: function ( arraybuffer ) {\n\n\t\tfunction convert( font, reversed ) {\n\n\t\t\tvar round = Math.round;\n\n\t\t\tvar glyphs = {};\n\t\t\tvar scale = ( 100000 ) / ( ( font.unitsPerEm || 2048 ) * 72 );\n\n\t\t\tvar glyphIndexMap = font.encoding.cmap.glyphIndexMap;\n\t\t\tvar unicodes = Object.keys( glyphIndexMap );\n\n\t\t\tfor ( var i = 0; i < unicodes.length; i ++ ) {\n\n\t\t\t\tvar unicode = unicodes[ i ];\n\t\t\t\tvar glyph = font.glyphs.glyphs[ glyphIndexMap[ unicode ] ];\n\n\t\t\t\tif ( unicode !== undefined ) {\n\n\t\t\t\t\tvar token = {\n\t\t\t\t\t\tha: round( glyph.advanceWidth * scale ),\n\t\t\t\t\t\tx_min: round( glyph.xMin * scale ),\n\t\t\t\t\t\tx_max: round( glyph.xMax * scale ),\n\t\t\t\t\t\to: ''\n\t\t\t\t\t};\n\n\t\t\t\t\tif ( reversed ) {\n\n\t\t\t\t\t\tglyph.path.commands = reverseCommands( glyph.path.commands );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tglyph.path.commands.forEach( function ( command ) {\n\n\t\t\t\t\t\tif ( command.type.toLowerCase() === 'c' ) {\n\n\t\t\t\t\t\t\tcommand.type = 'b';\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttoken.o += command.type.toLowerCase() + ' ';\n\n\t\t\t\t\t\tif ( command.x !== undefined && command.y !== undefined ) {\n\n\t\t\t\t\t\t\ttoken.o += round( command.x * scale ) + ' ' + round( command.y * scale ) + ' ';\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( command.x1 !== undefined && command.y1 !== undefined ) {\n\n\t\t\t\t\t\t\ttoken.o += round( command.x1 * scale ) + ' ' + round( command.y1 * scale ) + ' ';\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( command.x2 !== undefined && command.y2 !== undefined ) {\n\n\t\t\t\t\t\t\ttoken.o += round( command.x2 * scale ) + ' ' + round( command.y2 * scale ) + ' ';\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} );\n\n\t\t\t\t\tglyphs[ String.fromCodePoint( glyph.unicode ) ] = token;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tglyphs: glyphs,\n\t\t\t\tfamilyName: font.getEnglishName( 'fullName' ),\n\t\t\t\tascender: round( font.ascender * scale ),\n\t\t\t\tdescender: round( font.descender * scale ),\n\t\t\t\tunderlinePosition: font.tables.post.underlinePosition,\n\t\t\t\tunderlineThickness: font.tables.post.underlineThickness,\n\t\t\t\tboundingBox: {\n\t\t\t\t\txMin: font.tables.head.xMin,\n\t\t\t\t\txMax: font.tables.head.xMax,\n\t\t\t\t\tyMin: font.tables.head.yMin,\n\t\t\t\t\tyMax: font.tables.head.yMax\n\t\t\t\t},\n\t\t\t\tresolution: 1000,\n\t\t\t\toriginal_font_information: font.tables.name\n\t\t\t};\n\n\t\t}\n\n\t\tfunction reverseCommands( commands ) {\n\n\t\t\tvar paths = [];\n\t\t\tvar path;\n\n\t\t\tcommands.forEach( function ( c ) {\n\n\t\t\t\tif ( c.type.toLowerCase() === 'm' ) {\n\n\t\t\t\t\tpath = [ c ];\n\t\t\t\t\tpaths.push( path );\n\n\t\t\t\t} else if ( c.type.toLowerCase() !== 'z' ) {\n\n\t\t\t\t\tpath.push( c );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\tvar reversed = [];\n\n\t\t\tpaths.forEach( function ( p ) {\n\n\t\t\t\tvar result = {\n\t\t\t\t\ttype: 'm',\n\t\t\t\t\tx: p[ p.length - 1 ].x,\n\t\t\t\t\ty: p[ p.length - 1 ].y\n\t\t\t\t};\n\n\t\t\t\treversed.push( result );\n\n\t\t\t\tfor ( var i = p.length - 1; i > 0; i -- ) {\n\n\t\t\t\t\tvar command = p[ i ];\n\t\t\t\t\tvar result = { type: command.type };\n\n\t\t\t\t\tif ( command.x2 !== undefined && command.y2 !== undefined ) {\n\n\t\t\t\t\t\tresult.x1 = command.x2;\n\t\t\t\t\t\tresult.y1 = command.y2;\n\t\t\t\t\t\tresult.x2 = command.x1;\n\t\t\t\t\t\tresult.y2 = command.y1;\n\n\t\t\t\t\t} else if ( command.x1 !== undefined && command.y1 !== undefined ) {\n\n\t\t\t\t\t\tresult.x1 = command.x1;\n\t\t\t\t\t\tresult.y1 = command.y1;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tresult.x = p[ i - 1 ].x;\n\t\t\t\t\tresult.y = p[ i - 1 ].y;\n\t\t\t\t\treversed.push( result );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\treturn reversed;\n\n\t\t}\n\n\t\tif ( typeof opentype === 'undefined' ) {\n\n\t\t\tconsole.warn( 'THREE.TTFLoader: The loader requires opentype.js. Make sure it\\'s included before using the loader.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\treturn convert( opentype.parse( arraybuffer ), this.reversed );\n\n\t}\n\n} );\n\nexport { TTFLoader };\n"]}