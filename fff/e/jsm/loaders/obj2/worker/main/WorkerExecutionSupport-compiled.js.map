{"version":3,"sources":["WorkerExecutionSupport.js"],"names":[],"mappings":"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","file":"WorkerExecutionSupport-compiled.js","sourcesContent":["/**\n * @author Kai Salmen / https://kaisalmen.de\n * Development repository: https://github.com/kaisalmen/WWOBJLoader\n */\n\n/**\n * These instructions are used by {WorkerExecutionSupport} to build code for the web worker or to assign code\n *\n * @param {boolean} supportsStandardWorker\n * @param {boolean} supportsJsmWorker\n * @constructor\n */\nconst CodeBuilderInstructions = function ( supportsStandardWorker, supportsJsmWorker, preferJsmWorker ) {\n\n\tthis.supportsStandardWorker = supportsStandardWorker;\n\tthis.supportsJsmWorker = supportsJsmWorker;\n\tthis.preferJsmWorker = preferJsmWorker;\n\tthis.startCode = '';\n\tthis.codeFragments = [];\n\tthis.importStatements = [];\n\n\tthis.jsmWorkerFile = null;\n\tthis.defaultGeometryType = 0;\n\n};\n\nCodeBuilderInstructions.prototype = {\n\n\tconstructor: CodeBuilderInstructions,\n\n\tisSupportsStandardWorker: function () {\n\n\t\treturn this.supportsStandardWorker;\n\n\t},\n\n\tisSupportsJsmWorker: function () {\n\n\t\treturn this.supportsJsmWorker;\n\n\t},\n\n\tisPreferJsmWorker: function () {\n\n\t\treturn this.preferJsmWorker;\n\n\t},\n\n\t/**\n\t * Set the full path to the module that contains the worker code.\n\t *\n\t * @param {String} jsmWorkerFile\n\t */\n\tsetJsmWorkerFile: function ( jsmWorkerFile ) {\n\n\t\tif ( jsmWorkerFile !== undefined && jsmWorkerFile !== null ) {\n\n\t\t\tthis.jsmWorkerFile = jsmWorkerFile;\n\n\t\t}\n\n\t},\n\n\t/**\n\t * Add code that is contained in addition to fragments and libraries\n\t * @param {String} startCode\n\t */\n\taddStartCode: function ( startCode ) {\n\n\t\tthis.startCode = startCode;\n\n\t},\n\n\t/**\n\t * Add code fragment that is included in the provided order\n\t * @param {String} code\n\t */\n\taddCodeFragment: function ( code ) {\n\n\t\tthis.codeFragments.push( code );\n\n\t},\n\n\t/**\n\t * Add full path to a library that is contained at the start of the worker via \"importScripts\"\n\t * @param {String} libraryPath\n\t */\n\taddLibraryImport: function ( libraryPath ) {\n\n\t\tlet libraryUrl = new URL( libraryPath, window.location.href ).href;\n\t\tlet code = 'importScripts( \"' + libraryUrl + '\" );';\n\t\tthis.importStatements.push(\tcode );\n\n\t},\n\n\tgetImportStatements: function () {\n\n\t\treturn this.importStatements;\n\n\t},\n\n\tgetCodeFragments: function () {\n\n\t\treturn this.codeFragments;\n\n\t},\n\n\tgetStartCode: function () {\n\n\t\treturn this.startCode;\n\n\t}\n\n};\n/**\n * This class provides means to transform existing parser code into a web worker. It defines a simple communication protocol\n * which allows to configure the worker and receive raw mesh data during execution.\n * @class\n */\nconst WorkerExecutionSupport = function () {\n\n\t// check worker support first\n\tif ( window.Worker === undefined ) throw \"This browser does not support web workers!\";\n\tif ( window.Blob === undefined ) throw \"This browser does not support Blob!\";\n\tif ( typeof window.URL.createObjectURL !== 'function' ) throw \"This browser does not support Object creation from URL!\";\n\n\tthis._reset();\n\n};\nWorkerExecutionSupport.WORKER_SUPPORT_VERSION = '3.1.0';\nconsole.info( 'Using WorkerSupport version: ' + WorkerExecutionSupport.WORKER_SUPPORT_VERSION );\n\n\nWorkerExecutionSupport.prototype = {\n\n\tconstructor: WorkerExecutionSupport,\n\n\t_reset: function () {\n\n\t\tthis.logging = {\n\t\t\tenabled: false,\n\t\t\tdebug: false\n\t\t};\n\n\t\tlet scope = this;\n\t\tlet scopeTerminate = function ( ) {\n\n\t\t\tscope._terminate();\n\n\t\t};\n\t\tthis.worker = {\n\t\t\tnative: null,\n\t\t\tjsmWorker: false,\n\t\t\tlogging: true,\n\t\t\tworkerRunner: {\n\t\t\t\tname: 'WorkerRunner',\n\t\t\t\tusesMeshDisassembler: false,\n\t\t\t\tdefaultGeometryType: 0\n\t\t\t},\n\t\t\tterminateWorkerOnLoad: true,\n\t\t\tforceWorkerDataCopy: false,\n\t\t\tstarted: false,\n\t\t\tqueuedMessage: null,\n\t\t\tcallbacks: {\n\t\t\t\tonAssetAvailable: null,\n\t\t\t\tonLoad: null,\n\t\t\t\tterminate: scopeTerminate\n\t\t\t}\n\t\t};\n\n\t},\n\n\t/**\n\t * Enable or disable logging in general (except warn and error), plus enable or disable debug logging.\n\t *\n\t * @param {boolean} enabled True or false.\n\t * @param {boolean} debug True or false.\n\t */\n\tsetLogging: function ( enabled, debug ) {\n\n\t\tthis.logging.enabled = enabled === true;\n\t\tthis.logging.debug = debug === true;\n\t\tthis.worker.logging = enabled === true;\n\t\treturn this;\n\n\t},\n\n\t/**\n\t * Forces all ArrayBuffers to be transferred to worker to be copied.\n\t *\n\t * @param {boolean} forceWorkerDataCopy True or false.\n\t */\n\tsetForceWorkerDataCopy: function ( forceWorkerDataCopy ) {\n\n\t\tthis.worker.forceWorkerDataCopy = forceWorkerDataCopy === true;\n\t\treturn this;\n\n\t},\n\n\t/**\n\t * Request termination of worker once parser is finished.\n\t *\n\t * @param {boolean} terminateWorkerOnLoad True or false.\n\t */\n\tsetTerminateWorkerOnLoad: function ( terminateWorkerOnLoad ) {\n\n\t\tthis.worker.terminateWorkerOnLoad = terminateWorkerOnLoad === true;\n\t\tif ( this.worker.terminateWorkerOnLoad && this.isWorkerLoaded( this.worker.jsmWorker ) &&\n\t\t\t\tthis.worker.queuedMessage === null && this.worker.started ) {\n\n\t\t\tif ( this.logging.enabled ) {\n\n\t\t\t\tconsole.info( 'Worker is terminated immediately as it is not running!' );\n\n\t\t\t}\n\t\t\tthis._terminate();\n\n\t\t}\n\t\treturn this;\n\n\t},\n\n\t/**\n\t * Update all callbacks.\n\t *\n\t * @param {Function} onAssetAvailable The function for processing the data, e.g. {@link MeshReceiver}.\n\t * @param {Function} [onLoad] The function that is called when parsing is complete.\n\t */\n\tupdateCallbacks: function ( onAssetAvailable, onLoad ) {\n\n\t\tif ( onAssetAvailable !== undefined && onAssetAvailable !== null ) {\n\n\t\t\tthis.worker.callbacks.onAssetAvailable = onAssetAvailable;\n\n\t\t}\n\t\tif ( onLoad !== undefined && onLoad !== null ) {\n\n\t\t\tthis.worker.callbacks.onLoad = onLoad;\n\n\t\t}\n\t\tthis._verifyCallbacks();\n\n\t},\n\n\t_verifyCallbacks: function () {\n\n\t\tif ( this.worker.callbacks.onAssetAvailable === undefined || this.worker.callbacks.onAssetAvailable === null ) {\n\n\t\t\tthrow 'Unable to run as no \"onAssetAvailable\" callback is set.';\n\n\t\t}\n\n\t},\n\n\t/**\n\t * Builds the worker code according the provided Instructions.\n\t * If jsm worker code shall be built, then function may fall back to standard if lag is set\n\t *\n \t * @param {CodeBuilderInstructions} codeBuilderInstructions\n\t */\n\tbuildWorker: function ( codeBuilderInstructions ) {\n\n\t\tlet jsmSuccess = false;\n\n\t\tif ( codeBuilderInstructions.isSupportsJsmWorker() && codeBuilderInstructions.isPreferJsmWorker() ) {\n\n\t\t\tjsmSuccess = this._buildWorkerJsm( codeBuilderInstructions );\n\n\t\t}\n\n\t\tif ( ! jsmSuccess && codeBuilderInstructions.isSupportsStandardWorker() ) {\n\n\t\t\tthis._buildWorkerStandard( codeBuilderInstructions );\n\n\t\t}\n\n\t},\n\n\t/**\n\t *\n\t * @param {CodeBuilderInstructions} codeBuilderInstructions\n\t * @return {boolean} Whether loading of jsm worker was successful\n\t * @private\n\t */\n\t_buildWorkerJsm: function ( codeBuilderInstructions ) {\n\n\t\tlet jsmSuccess = true;\n\t\tlet timeLabel = 'buildWorkerJsm';\n\t\tlet workerAvailable = this._buildWorkerCheckPreconditions( true, timeLabel );\n\t\tif ( ! workerAvailable ) {\n\n\t\t\tlet workerFileUrl = new URL( codeBuilderInstructions.jsmWorkerFile, window.location.href ).href;\n\t\t\ttry {\n\n\t\t\t\tlet worker = new Worker( workerFileUrl, { type: \"module\" } );\n\t\t\t\tthis._configureWorkerCommunication( worker, true, codeBuilderInstructions.defaultGeometryType, timeLabel );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\tjsmSuccess = false;\n\t\t\t\t// Chrome throws this exception, but Firefox currently does not complain, but can't execute the worker afterwards\n\t\t\t\tif ( e instanceof TypeError || e instanceof SyntaxError ) {\n\n\t\t\t\t\tconsole.error( \"Modules are not supported in workers.\" );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn jsmSuccess;\n\n\t},\n\n\t/**\n\t * Validate the status of worker code and the derived worker and specify functions that should be build when new raw mesh data becomes available and when the parser is finished.\n\t *\n\t * @param {CodeBuilderIns} buildWorkerCode The function that is invoked to create the worker code of the parser.\n\t */\n\n\t/**\n\t *\n\t * @param {CodeBuilderInstructions} codeBuilderInstructions\n\t * @private\n\t */\n\t_buildWorkerStandard: function ( codeBuilderInstructions ) {\n\n\t\tlet timeLabel = 'buildWorkerStandard';\n\t\tlet workerAvailable = this._buildWorkerCheckPreconditions( false, timeLabel );\n\t\tif ( ! workerAvailable ) {\n\n\t\t\tlet concatenateCode = '';\n\t\t\tcodeBuilderInstructions.getImportStatements().forEach( function ( element ) {\n\n\t\t\t\tconcatenateCode += element + '\\n';\n\n\t\t\t} );\n\t\t\tconcatenateCode += '\\n';\n\t\t\tcodeBuilderInstructions.getCodeFragments().forEach( function ( element ) {\n\n\t\t\t\tconcatenateCode += element + '\\n';\n\n\t\t\t} );\n\t\t\tconcatenateCode += '\\n';\n\t\t\tconcatenateCode += codeBuilderInstructions.getStartCode();\n\n\t\t\tlet blob = new Blob( [ concatenateCode ], { type: 'application/javascript' } );\n\t\t\tlet worker = new Worker( window.URL.createObjectURL( blob ) );\n\n\t\t\tthis._configureWorkerCommunication( worker, false, codeBuilderInstructions.defaultGeometryType, timeLabel );\n\n\t\t}\n\n\t},\n\n\t_buildWorkerCheckPreconditions: function ( requireJsmWorker, timeLabel ) {\n\n\t\tlet workerAvailable = false;\n\t\tif ( this.isWorkerLoaded( requireJsmWorker ) ) {\n\n\t\t\tworkerAvailable = true;\n\n\t\t} else {\n\n\t\t\tif ( this.logging.enabled ) {\n\n\t\t\t\tconsole.info( 'WorkerExecutionSupport: Building ' + ( requireJsmWorker ? 'jsm' : 'standard' ) + ' worker code...' );\n\t\t\t\tconsole.time( timeLabel );\n\n\t\t\t}\n\n\t\t}\n\t\treturn workerAvailable;\n\n\t},\n\n\t_configureWorkerCommunication: function ( worker, haveJsmWorker, defaultGeometryType, timeLabel ) {\n\n\t\tthis.worker.native = worker;\n\t\tthis.worker.jsmWorker = haveJsmWorker;\n\n\t\tlet scope = this;\n\t\tlet scopedReceiveWorkerMessage = function ( event ) {\n\n\t\t\tscope._receiveWorkerMessage( event );\n\n\t\t};\n\t\tthis.worker.native.onmessage = scopedReceiveWorkerMessage;\n\t\tif ( defaultGeometryType !== undefined && defaultGeometryType !== null ) {\n\n\t\t\tthis.worker.workerRunner.defaultGeometryType = defaultGeometryType;\n\n\t\t}\n\n\t\tif ( this.logging.enabled ) {\n\n\t\t\tconsole.timeEnd( timeLabel );\n\n\t\t}\n\n\t},\n\n\t/**\n\t * Returns if Worker code is available and complies with expectation.\n\t * @param {boolean} requireJsmWorker\n\t * @return {boolean|*}\n\t */\n\tisWorkerLoaded: function ( requireJsmWorker ) {\n\n\t\treturn this.worker.native !== null &&\n\t\t\t( ( requireJsmWorker && this.worker.jsmWorker ) || ( ! requireJsmWorker && ! this.worker.jsmWorker ) );\n\n\t},\n\n\t/**\n\t * Executed in worker scope\n\t */\n\t_receiveWorkerMessage: function ( event ) {\n\n\t\tlet payload = event.data;\n\t\tlet workerRunnerName = this.worker.workerRunner.name;\n\n\t\tswitch ( payload.cmd ) {\n\n\t\t\tcase 'assetAvailable':\n\t\t\t\tthis.worker.callbacks.onAssetAvailable( payload );\n\t\t\t\tbreak;\n\n\t\t\tcase 'completeOverall':\n\t\t\t\tthis.worker.queuedMessage = null;\n\t\t\t\tthis.worker.started = false;\n\t\t\t\tif ( this.worker.callbacks.onLoad !== null ) {\n\n\t\t\t\t\tthis.worker.callbacks.onLoad( payload.msg );\n\n\t\t\t\t}\n\t\t\t\tif ( this.worker.terminateWorkerOnLoad ) {\n\n\t\t\t\t\tif ( this.worker.logging.enabled ) {\n\n\t\t\t\t\t\tconsole.info( 'WorkerSupport [' + workerRunnerName + ']: Run is complete. Terminating application on request!' );\n\n\t\t\t\t\t}\n\t\t\t\t\tthis.worker.callbacks.terminate();\n\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'error':\n\t\t\t\tconsole.error( 'WorkerSupport [' + workerRunnerName + ']: Reported error: ' + payload.msg );\n\t\t\t\tthis.worker.queuedMessage = null;\n\t\t\t\tthis.worker.started = false;\n\t\t\t\tif ( this.worker.callbacks.onLoad !== null ) {\n\n\t\t\t\t\tthis.worker.callbacks.onLoad( payload.msg );\n\n\t\t\t\t}\n\t\t\t\tif ( this.worker.terminateWorkerOnLoad ) {\n\n\t\t\t\t\tif ( this.worker.logging.enabled ) {\n\n\t\t\t\t\t\tconsole.info( 'WorkerSupport [' + workerRunnerName + ']: Run reported error. Terminating application on request!' );\n\n\t\t\t\t\t}\n\t\t\t\t\tthis.worker.callbacks.terminate();\n\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tconsole.error( 'WorkerSupport [' + workerRunnerName + ']: Received unknown command: ' + payload.cmd );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t},\n\n\t/**\n\t * Runs the parser with the provided configuration.\n\t *\n\t * @param {Object} payload Raw mesh description (buffers, params, materials) used to build one to many meshes.\n\t */\n\texecuteParallel: function ( payload, transferables ) {\n\n\t\tpayload.cmd = 'parse';\n\t\tpayload.usesMeshDisassembler = this.worker.workerRunner.usesMeshDisassembler;\n\t\tpayload.defaultGeometryType = this.worker.workerRunner.defaultGeometryType;\n\t\tif ( ! this._verifyWorkerIsAvailable( payload, transferables ) ) return;\n\n\t\tthis._postMessage();\n\n\t},\n\n\t_verifyWorkerIsAvailable: function ( payload, transferables ) {\n\n\t\tthis._verifyCallbacks();\n\t\tlet ready = true;\n\t\tif ( this.worker.queuedMessage !== null ) {\n\n\t\t\tconsole.warn( 'Already processing message. Rejecting new run instruction' );\n\t\t\tready = false;\n\n\t\t} else {\n\n\t\t\tthis.worker.queuedMessage = {\n\t\t\t\tpayload: payload,\n\t\t\t\ttransferables: ( transferables === undefined || transferables === null ) ? [] : transferables\n\t\t\t};\n\t\t\tthis.worker.started = true;\n\n\t\t}\n\t\treturn ready;\n\n\t},\n\n\t_postMessage: function () {\n\n\t\tif ( this.worker.queuedMessage !== null ) {\n\n\t\t\tif ( this.worker.queuedMessage.payload.data.input instanceof ArrayBuffer ) {\n\n\t\t\t\tlet transferables = [];\n\t\t\t\tif ( this.worker.forceWorkerDataCopy ) {\n\n\t\t\t\t\ttransferables.push( this.worker.queuedMessage.payload.data.input.slice( 0 ) );\n\n\t\t\t\t} else {\n\n\t\t\t\t\ttransferables.push( this.worker.queuedMessage.payload.data.input );\n\n\t\t\t\t}\n\t\t\t\tif ( this.worker.queuedMessage.transferables.length > 0 ) {\n\n\t\t\t\t\ttransferables = transferables.concat( this.worker.queuedMessage.transferables );\n\n\t\t\t\t}\n\t\t\t\tthis.worker.native.postMessage( this.worker.queuedMessage.payload, transferables );\n\n\t\t\t} else {\n\n\t\t\t\tthis.worker.native.postMessage( this.worker.queuedMessage.payload );\n\n\t\t\t}\n\n\t\t}\n\n\t},\n\n\t_terminate: function () {\n\n\t\tthis.worker.native.terminate();\n\t\tthis._reset();\n\n\t}\n};\n\nexport {\n\tCodeBuilderInstructions,\n\tWorkerExecutionSupport\n};\n"]}