{"version":3,"sources":["LegacyGLTFLoader.js"],"names":[],"mappings":"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","file":"LegacyGLTFLoader-compiled.js","sourcesContent":["/**\n * @author Rich Tibbett / https://github.com/richtr\n * @author mrdoob / http://mrdoob.com/\n * @author Tony Parisi / http://www.tonyparisi.com/\n * @author Takahiro / https://github.com/takahirox\n */\n\nimport {\n\tAddEquation,\n\tAlphaFormat,\n\tAlwaysDepth,\n\tAmbientLight,\n\tAnimationClip,\n\tAnimationUtils,\n\tBackSide,\n\tBone,\n\tBufferAttribute,\n\tBufferGeometry,\n\tClampToEdgeWrapping,\n\tColor,\n\tCustomBlending,\n\tDirectionalLight,\n\tDoubleSide,\n\tDstAlphaFactor,\n\tDstColorFactor,\n\tEqualDepth,\n\tFileLoader,\n\tFrontSide,\n\tGreaterEqualDepth,\n\tGroup,\n\tInterleavedBuffer,\n\tInterleavedBufferAttribute,\n\tInterpolateDiscrete,\n\tInterpolateLinear,\n\tLessDepth,\n\tLessEqualDepth,\n\tLine,\n\tLineLoop,\n\tLineSegments,\n\tLinearFilter,\n\tLinearMipmapLinearFilter,\n\tLinearMipmapNearestFilter,\n\tLoader,\n\tLoaderUtils,\n\tLuminanceAlphaFormat,\n\tLuminanceFormat,\n\tMath as _Math,\n\tMatrix3,\n\tMatrix4,\n\tMesh,\n\tMeshBasicMaterial,\n\tMeshLambertMaterial,\n\tMeshPhongMaterial,\n\tMirroredRepeatWrapping,\n\tNearestFilter,\n\tNearestMipmapLinearFilter,\n\tNearestMipmapNearestFilter,\n\tNeverDepth,\n\tNoBlending,\n\tNotEqualDepth,\n\tObject3D,\n\tOneFactor,\n\tOneMinusDstAlphaFactor,\n\tOneMinusDstColorFactor,\n\tOneMinusSrcAlphaFactor,\n\tOneMinusSrcColorFactor,\n\tOrthographicCamera,\n\tPerspectiveCamera,\n\tPointLight,\n\tQuaternionKeyframeTrack,\n\tRGBAFormat,\n\tRGBFormat,\n\tRawShaderMaterial,\n\tRepeatWrapping,\n\tReverseSubtractEquation,\n\tScene,\n\tSkeleton,\n\tSkinnedMesh,\n\tSpotLight,\n\tSrcAlphaFactor,\n\tSrcAlphaSaturateFactor,\n\tSrcColorFactor,\n\tSubtractEquation,\n\tTexture,\n\tTextureLoader,\n\tUniformsUtils,\n\tUnsignedByteType,\n\tUnsignedShort4444Type,\n\tUnsignedShort5551Type,\n\tUnsignedShort565Type,\n\tVector2,\n\tVector3,\n\tVector4,\n\tVectorKeyframeTrack,\n\tZeroFactor\n} from \"../../../../build/three.module.js\";\n\nvar LegacyGLTFLoader = ( function () {\n\n\tfunction LegacyGLTFLoader( manager ) {\n\n\t\tLoader.call( this, manager );\n\n\t}\n\n\tLegacyGLTFLoader.prototype = Object.assign( Object.create( Loader.prototype ), {\n\n\t\tconstructor: LegacyGLTFLoader,\n\n\t\tload: function ( url, onLoad, onProgress, onError ) {\n\n\t\t\tvar scope = this;\n\n\t\t\tvar resourcePath;\n\n\t\t\tif ( this.resourcePath !== '' ) {\n\n\t\t\t\tresourcePath = this.resourcePath;\n\n\t\t\t} else if ( this.path !== '' ) {\n\n\t\t\t\tresourcePath = this.path;\n\n\t\t\t} else {\n\n\t\t\t\tresourcePath = LoaderUtils.extractUrlBase( url );\n\n\t\t\t}\n\n\t\t\tvar loader = new FileLoader( scope.manager );\n\n\t\t\tloader.setPath( this.path );\n\t\t\tloader.setResponseType( 'arraybuffer' );\n\n\t\t\tloader.load( url, function ( data ) {\n\n\t\t\t\tscope.parse( data, resourcePath, onLoad );\n\n\t\t\t}, onProgress, onError );\n\n\t\t},\n\n\t\tparse: function ( data, path, callback ) {\n\n\t\t\tvar content;\n\t\t\tvar extensions = {};\n\n\t\t\tvar magic = LoaderUtils.decodeText( new Uint8Array( data, 0, 4 ) );\n\n\t\t\tif ( magic === BINARY_EXTENSION_HEADER_DEFAULTS.magic ) {\n\n\t\t\t\textensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );\n\t\t\t\tcontent = extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content;\n\n\t\t\t} else {\n\n\t\t\t\tcontent = LoaderUtils.decodeText( new Uint8Array( data ) );\n\n\t\t\t}\n\n\t\t\tvar json = JSON.parse( content );\n\n\t\t\tif ( json.extensionsUsed && json.extensionsUsed.indexOf( EXTENSIONS.KHR_MATERIALS_COMMON ) >= 0 ) {\n\n\t\t\t\textensions[ EXTENSIONS.KHR_MATERIALS_COMMON ] = new GLTFMaterialsCommonExtension( json );\n\n\t\t\t}\n\n\t\t\tvar parser = new GLTFParser( json, extensions, {\n\n\t\t\t\tcrossOrigin: this.crossOrigin,\n\t\t\t\tmanager: this.manager,\n\t\t\t\tpath: path || this.resourcePath || ''\n\n\t\t\t} );\n\n\t\t\tparser.parse( function ( scene, scenes, cameras, animations ) {\n\n\t\t\t\tvar glTF = {\n\t\t\t\t\t\"scene\": scene,\n\t\t\t\t\t\"scenes\": scenes,\n\t\t\t\t\t\"cameras\": cameras,\n\t\t\t\t\t\"animations\": animations\n\t\t\t\t};\n\n\t\t\t\tcallback( glTF );\n\n\t\t\t} );\n\n\t\t}\n\n\t} );\n\n\t/* GLTFREGISTRY */\n\n\tfunction GLTFRegistry() {\n\n\t\tvar objects = {};\n\n\t\treturn\t{\n\n\t\t\tget: function ( key ) {\n\n\t\t\t\treturn objects[ key ];\n\n\t\t\t},\n\n\t\t\tadd: function ( key, object ) {\n\n\t\t\t\tobjects[ key ] = object;\n\n\t\t\t},\n\n\t\t\tremove: function ( key ) {\n\n\t\t\t\tdelete objects[ key ];\n\n\t\t\t},\n\n\t\t\tremoveAll: function () {\n\n\t\t\t\tobjects = {};\n\n\t\t\t},\n\n\t\t\tupdate: function ( scene, camera ) {\n\n\t\t\t\tfor ( var name in objects ) {\n\n\t\t\t\t\tvar object = objects[ name ];\n\n\t\t\t\t\tif ( object.update ) {\n\n\t\t\t\t\t\tobject.update( scene, camera );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t};\n\n\t}\n\n\t/* GLTFSHADERS */\n\n\tLegacyGLTFLoader.Shaders = {\n\n\t\tupdate: function () {\n\n\t\t\tconsole.warn( 'THREE.LegacyGLTFLoader.Shaders has been deprecated, and now updates automatically.' );\n\n\t\t}\n\n\t};\n\n\t/* GLTFSHADER */\n\n\tfunction GLTFShader( targetNode, allNodes ) {\n\n\t\tvar boundUniforms = {};\n\n\t\t// bind each uniform to its source node\n\n\t\tvar uniforms = targetNode.material.uniforms;\n\n\t\tfor ( var uniformId in uniforms ) {\n\n\t\t\tvar uniform = uniforms[ uniformId ];\n\n\t\t\tif ( uniform.semantic ) {\n\n\t\t\t\tvar sourceNodeRef = uniform.node;\n\n\t\t\t\tvar sourceNode = targetNode;\n\n\t\t\t\tif ( sourceNodeRef ) {\n\n\t\t\t\t\tsourceNode = allNodes[ sourceNodeRef ];\n\n\t\t\t\t}\n\n\t\t\t\tboundUniforms[ uniformId ] = {\n\t\t\t\t\tsemantic: uniform.semantic,\n\t\t\t\t\tsourceNode: sourceNode,\n\t\t\t\t\ttargetNode: targetNode,\n\t\t\t\t\tuniform: uniform\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.boundUniforms = boundUniforms;\n\t\tthis._m4 = new Matrix4();\n\n\t}\n\n\t// Update - update all the uniform values\n\tGLTFShader.prototype.update = function ( scene, camera ) {\n\n\t\tvar boundUniforms = this.boundUniforms;\n\n\t\tfor ( var name in boundUniforms ) {\n\n\t\t\tvar boundUniform = boundUniforms[ name ];\n\n\t\t\tswitch ( boundUniform.semantic ) {\n\n\t\t\t\tcase \"MODELVIEW\":\n\n\t\t\t\t\tvar m4 = boundUniform.uniform.value;\n\t\t\t\t\tm4.multiplyMatrices( camera.matrixWorldInverse, boundUniform.sourceNode.matrixWorld );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"MODELVIEWINVERSETRANSPOSE\":\n\n\t\t\t\t\tvar m3 = boundUniform.uniform.value;\n\t\t\t\t\tthis._m4.multiplyMatrices( camera.matrixWorldInverse, boundUniform.sourceNode.matrixWorld );\n\t\t\t\t\tm3.getNormalMatrix( this._m4 );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"PROJECTION\":\n\n\t\t\t\t\tvar m4 = boundUniform.uniform.value;\n\t\t\t\t\tm4.copy( camera.projectionMatrix );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"JOINTMATRIX\":\n\n\t\t\t\t\tvar m4v = boundUniform.uniform.value;\n\n\t\t\t\t\tfor ( var mi = 0; mi < m4v.length; mi ++ ) {\n\n\t\t\t\t\t\t// So it goes like this:\n\t\t\t\t\t\t// SkinnedMesh world matrix is already baked into MODELVIEW;\n\t\t\t\t\t\t// transform joints to local space,\n\t\t\t\t\t\t// then transform using joint's inverse\n\t\t\t\t\t\tm4v[ mi ]\n\t\t\t\t\t\t\t.getInverse( boundUniform.sourceNode.matrixWorld )\n\t\t\t\t\t\t\t.multiply( boundUniform.targetNode.skeleton.bones[ mi ].matrixWorld )\n\t\t\t\t\t\t\t.multiply( boundUniform.targetNode.skeleton.boneInverses[ mi ] )\n\t\t\t\t\t\t\t.multiply( boundUniform.targetNode.bindMatrix );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault :\n\n\t\t\t\t\tconsole.warn( \"Unhandled shader semantic: \" + boundUniform.semantic );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t};\n\n\n\t/* ANIMATION */\n\n\tLegacyGLTFLoader.Animations = {\n\n\t\tupdate: function () {\n\n\t\t\tconsole.warn( 'THREE.LegacyGLTFLoader.Animation has been deprecated. Use THREE.AnimationMixer instead.' );\n\n\t\t}\n\n\t};\n\n\t/*********************************/\n\t/********** EXTENSIONS ***********/\n\t/*********************************/\n\n\tvar EXTENSIONS = {\n\t\tKHR_BINARY_GLTF: 'KHR_binary_glTF',\n\t\tKHR_MATERIALS_COMMON: 'KHR_materials_common'\n\t};\n\n\t/* MATERIALS COMMON EXTENSION */\n\n\tfunction GLTFMaterialsCommonExtension( json ) {\n\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_COMMON;\n\n\t\tthis.lights = {};\n\n\t\tvar extension = ( json.extensions && json.extensions[ EXTENSIONS.KHR_MATERIALS_COMMON ] ) || {};\n\t\tvar lights = extension.lights || {};\n\n\t\tfor ( var lightId in lights ) {\n\n\t\t\tvar light = lights[ lightId ];\n\t\t\tvar lightNode;\n\n\t\t\tvar lightParams = light[ light.type ];\n\t\t\tvar color = new Color().fromArray( lightParams.color );\n\n\t\t\tswitch ( light.type ) {\n\n\t\t\t\tcase \"directional\":\n\t\t\t\t\tlightNode = new DirectionalLight( color );\n\t\t\t\t\tlightNode.position.set( 0, 0, 1 );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"point\":\n\t\t\t\t\tlightNode = new PointLight( color );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"spot\":\n\t\t\t\t\tlightNode = new SpotLight( color );\n\t\t\t\t\tlightNode.position.set( 0, 0, 1 );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"ambient\":\n\t\t\t\t\tlightNode = new AmbientLight( color );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif ( lightNode ) {\n\n\t\t\t\tthis.lights[ lightId ] = lightNode;\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t/* BINARY EXTENSION */\n\n\tvar BINARY_EXTENSION_BUFFER_NAME = 'binary_glTF';\n\n\tvar BINARY_EXTENSION_HEADER_DEFAULTS = { magic: 'glTF', version: 1, contentFormat: 0 };\n\n\tvar BINARY_EXTENSION_HEADER_LENGTH = 20;\n\n\tfunction GLTFBinaryExtension( data ) {\n\n\t\tthis.name = EXTENSIONS.KHR_BINARY_GLTF;\n\n\t\tvar headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );\n\n\t\tvar header = {\n\t\t\tmagic: LoaderUtils.decodeText( new Uint8Array( data.slice( 0, 4 ) ) ),\n\t\t\tversion: headerView.getUint32( 4, true ),\n\t\t\tlength: headerView.getUint32( 8, true ),\n\t\t\tcontentLength: headerView.getUint32( 12, true ),\n\t\t\tcontentFormat: headerView.getUint32( 16, true )\n\t\t};\n\n\t\tfor ( var key in BINARY_EXTENSION_HEADER_DEFAULTS ) {\n\n\t\t\tvar value = BINARY_EXTENSION_HEADER_DEFAULTS[ key ];\n\n\t\t\tif ( header[ key ] !== value ) {\n\n\t\t\t\tthrow new Error( 'Unsupported glTF-Binary header: Expected \"%s\" to be \"%s\".', key, value );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvar contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH, header.contentLength );\n\n\t\tthis.header = header;\n\t\tthis.content = LoaderUtils.decodeText( contentArray );\n\t\tthis.body = data.slice( BINARY_EXTENSION_HEADER_LENGTH + header.contentLength, header.length );\n\n\t}\n\n\tGLTFBinaryExtension.prototype.loadShader = function ( shader, bufferViews ) {\n\n\t\tvar bufferView = bufferViews[ shader.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].bufferView ];\n\t\tvar array = new Uint8Array( bufferView );\n\n\t\treturn LoaderUtils.decodeText( array );\n\n\t};\n\n\t/*********************************/\n\t/********** INTERNALS ************/\n\t/*********************************/\n\n\t/* CONSTANTS */\n\n\tvar WEBGL_CONSTANTS = {\n\t\tFLOAT: 5126,\n\t\t//FLOAT_MAT2: 35674,\n\t\tFLOAT_MAT3: 35675,\n\t\tFLOAT_MAT4: 35676,\n\t\tFLOAT_VEC2: 35664,\n\t\tFLOAT_VEC3: 35665,\n\t\tFLOAT_VEC4: 35666,\n\t\tLINEAR: 9729,\n\t\tREPEAT: 10497,\n\t\tSAMPLER_2D: 35678,\n\t\tTRIANGLES: 4,\n\t\tLINES: 1,\n\t\tUNSIGNED_BYTE: 5121,\n\t\tUNSIGNED_SHORT: 5123,\n\n\t\tVERTEX_SHADER: 35633,\n\t\tFRAGMENT_SHADER: 35632\n\t};\n\n\tvar WEBGL_TYPE = {\n\t\t5126: Number,\n\t\t//35674: Matrix2,\n\t\t35675: Matrix3,\n\t\t35676: Matrix4,\n\t\t35664: Vector2,\n\t\t35665: Vector3,\n\t\t35666: Vector4,\n\t\t35678: Texture\n\t};\n\n\tvar WEBGL_COMPONENT_TYPES = {\n\t\t5120: Int8Array,\n\t\t5121: Uint8Array,\n\t\t5122: Int16Array,\n\t\t5123: Uint16Array,\n\t\t5125: Uint32Array,\n\t\t5126: Float32Array\n\t};\n\n\tvar WEBGL_FILTERS = {\n\t\t9728: NearestFilter,\n\t\t9729: LinearFilter,\n\t\t9984: NearestMipmapNearestFilter,\n\t\t9985: LinearMipmapNearestFilter,\n\t\t9986: NearestMipmapLinearFilter,\n\t\t9987: LinearMipmapLinearFilter\n\t};\n\n\tvar WEBGL_WRAPPINGS = {\n\t\t33071: ClampToEdgeWrapping,\n\t\t33648: MirroredRepeatWrapping,\n\t\t10497: RepeatWrapping\n\t};\n\n\tvar WEBGL_TEXTURE_FORMATS = {\n\t\t6406: AlphaFormat,\n\t\t6407: RGBFormat,\n\t\t6408: RGBAFormat,\n\t\t6409: LuminanceFormat,\n\t\t6410: LuminanceAlphaFormat\n\t};\n\n\tvar WEBGL_TEXTURE_DATATYPES = {\n\t\t5121: UnsignedByteType,\n\t\t32819: UnsignedShort4444Type,\n\t\t32820: UnsignedShort5551Type,\n\t\t33635: UnsignedShort565Type\n\t};\n\n\tvar WEBGL_SIDES = {\n\t\t1028: BackSide, // Culling front\n\t\t1029: FrontSide // Culling back\n\t\t//1032: NoSide   // Culling front and back, what to do?\n\t};\n\n\tvar WEBGL_DEPTH_FUNCS = {\n\t\t512: NeverDepth,\n\t\t513: LessDepth,\n\t\t514: EqualDepth,\n\t\t515: LessEqualDepth,\n\t\t516: GreaterEqualDepth,\n\t\t517: NotEqualDepth,\n\t\t518: GreaterEqualDepth,\n\t\t519: AlwaysDepth\n\t};\n\n\tvar WEBGL_BLEND_EQUATIONS = {\n\t\t32774: AddEquation,\n\t\t32778: SubtractEquation,\n\t\t32779: ReverseSubtractEquation\n\t};\n\n\tvar WEBGL_BLEND_FUNCS = {\n\t\t0: ZeroFactor,\n\t\t1: OneFactor,\n\t\t768: SrcColorFactor,\n\t\t769: OneMinusSrcColorFactor,\n\t\t770: SrcAlphaFactor,\n\t\t771: OneMinusSrcAlphaFactor,\n\t\t772: DstAlphaFactor,\n\t\t773: OneMinusDstAlphaFactor,\n\t\t774: DstColorFactor,\n\t\t775: OneMinusDstColorFactor,\n\t\t776: SrcAlphaSaturateFactor\n\t\t// The followings are not supported by Three.js yet\n\t\t//32769: CONSTANT_COLOR,\n\t\t//32770: ONE_MINUS_CONSTANT_COLOR,\n\t\t//32771: CONSTANT_ALPHA,\n\t\t//32772: ONE_MINUS_CONSTANT_COLOR\n\t};\n\n\tvar WEBGL_TYPE_SIZES = {\n\t\t'SCALAR': 1,\n\t\t'VEC2': 2,\n\t\t'VEC3': 3,\n\t\t'VEC4': 4,\n\t\t'MAT2': 4,\n\t\t'MAT3': 9,\n\t\t'MAT4': 16\n\t};\n\n\tvar PATH_PROPERTIES = {\n\t\tscale: 'scale',\n\t\ttranslation: 'position',\n\t\trotation: 'quaternion'\n\t};\n\n\tvar INTERPOLATION = {\n\t\tLINEAR: InterpolateLinear,\n\t\tSTEP: InterpolateDiscrete\n\t};\n\n\tvar STATES_ENABLES = {\n\t\t2884: 'CULL_FACE',\n\t\t2929: 'DEPTH_TEST',\n\t\t3042: 'BLEND',\n\t\t3089: 'SCISSOR_TEST',\n\t\t32823: 'POLYGON_OFFSET_FILL',\n\t\t32926: 'SAMPLE_ALPHA_TO_COVERAGE'\n\t};\n\n\t/* UTILITY FUNCTIONS */\n\n\tfunction _each( object, callback, thisObj ) {\n\n\t\tif ( ! object ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tvar results;\n\t\tvar fns = [];\n\n\t\tif ( Object.prototype.toString.call( object ) === '[object Array]' ) {\n\n\t\t\tresults = [];\n\n\t\t\tvar length = object.length;\n\n\t\t\tfor ( var idx = 0; idx < length; idx ++ ) {\n\n\t\t\t\tvar value = callback.call( thisObj || this, object[ idx ], idx );\n\n\t\t\t\tif ( value ) {\n\n\t\t\t\t\tfns.push( value );\n\n\t\t\t\t\tif ( value instanceof Promise ) {\n\n\t\t\t\t\t\tvalue.then( function ( key, value ) {\n\n\t\t\t\t\t\t\tresults[ key ] = value;\n\n\t\t\t\t\t\t}.bind( this, idx ) );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tresults[ idx ] = value;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tresults = {};\n\n\t\t\tfor ( var key in object ) {\n\n\t\t\t\tif ( object.hasOwnProperty( key ) ) {\n\n\t\t\t\t\tvar value = callback.call( thisObj || this, object[ key ], key );\n\n\t\t\t\t\tif ( value ) {\n\n\t\t\t\t\t\tfns.push( value );\n\n\t\t\t\t\t\tif ( value instanceof Promise ) {\n\n\t\t\t\t\t\t\tvalue.then( function ( key, value ) {\n\n\t\t\t\t\t\t\t\tresults[ key ] = value;\n\n\t\t\t\t\t\t\t}.bind( this, key ) );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tresults[ key ] = value;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( fns ).then( function () {\n\n\t\t\treturn results;\n\n\t\t} );\n\n\t}\n\n\tfunction resolveURL( url, path ) {\n\n\t\t// Invalid URL\n\t\tif ( typeof url !== 'string' || url === '' )\n\t\t\treturn '';\n\n\t\t// Absolute URL http://,https://,//\n\t\tif ( /^(https?:)?\\/\\//i.test( url ) ) {\n\n\t\t\treturn url;\n\n\t\t}\n\n\t\t// Data URI\n\t\tif ( /^data:.*,.*$/i.test( url ) ) {\n\n\t\t\treturn url;\n\n\t\t}\n\n\t\t// Blob URL\n\t\tif ( /^blob:.*$/i.test( url ) ) {\n\n\t\t\treturn url;\n\n\t\t}\n\n\t\t// Relative URL\n\t\treturn ( path || '' ) + url;\n\n\t}\n\n\t// Three.js seems too dependent on attribute names so globally\n\t// replace those in the shader code\n\tfunction replaceTHREEShaderAttributes( shaderText, technique ) {\n\n\t\t// Expected technique attributes\n\t\tvar attributes = {};\n\n\t\tfor ( var attributeId in technique.attributes ) {\n\n\t\t\tvar pname = technique.attributes[ attributeId ];\n\n\t\t\tvar param = technique.parameters[ pname ];\n\t\t\tvar atype = param.type;\n\t\t\tvar semantic = param.semantic;\n\n\t\t\tattributes[ attributeId ] = {\n\t\t\t\ttype: atype,\n\t\t\t\tsemantic: semantic\n\t\t\t};\n\n\t\t}\n\n\t\t// Figure out which attributes to change in technique\n\n\t\tvar shaderParams = technique.parameters;\n\t\tvar shaderAttributes = technique.attributes;\n\t\tvar params = {};\n\n\t\tfor ( var attributeId in attributes ) {\n\n\t\t\tvar pname = shaderAttributes[ attributeId ];\n\t\t\tvar shaderParam = shaderParams[ pname ];\n\t\t\tvar semantic = shaderParam.semantic;\n\t\t\tif ( semantic ) {\n\n\t\t\t\tparams[ attributeId ] = shaderParam;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfor ( var pname in params ) {\n\n\t\t\tvar param = params[ pname ];\n\t\t\tvar semantic = param.semantic;\n\n\t\t\tvar regEx = new RegExp( \"\\\\b\" + pname + \"\\\\b\", \"g\" );\n\n\t\t\tswitch ( semantic ) {\n\n\t\t\t\tcase \"POSITION\":\n\n\t\t\t\t\tshaderText = shaderText.replace( regEx, 'position' );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"NORMAL\":\n\n\t\t\t\t\tshaderText = shaderText.replace( regEx, 'normal' );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'TEXCOORD_0':\n\t\t\t\tcase 'TEXCOORD0':\n\t\t\t\tcase 'TEXCOORD':\n\n\t\t\t\t\tshaderText = shaderText.replace( regEx, 'uv' );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'TEXCOORD_1':\n\n\t\t\t\t\tshaderText = shaderText.replace( regEx, 'uv2' );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'COLOR_0':\n\t\t\t\tcase 'COLOR0':\n\t\t\t\tcase 'COLOR':\n\n\t\t\t\t\tshaderText = shaderText.replace( regEx, 'color' );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"WEIGHT\":\n\n\t\t\t\t\tshaderText = shaderText.replace( regEx, 'skinWeight' );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"JOINT\":\n\n\t\t\t\t\tshaderText = shaderText.replace( regEx, 'skinIndex' );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn shaderText;\n\n\t}\n\n\tfunction createDefaultMaterial() {\n\n\t\treturn new MeshPhongMaterial( {\n\t\t\tcolor: 0x00000,\n\t\t\temissive: 0x888888,\n\t\t\tspecular: 0x000000,\n\t\t\tshininess: 0,\n\t\t\ttransparent: false,\n\t\t\tdepthTest: true,\n\t\t\tside: FrontSide\n\t\t} );\n\n\t}\n\n\t// Deferred constructor for RawShaderMaterial types\n\tfunction DeferredShaderMaterial( params ) {\n\n\t\tthis.isDeferredShaderMaterial = true;\n\n\t\tthis.params = params;\n\n\t}\n\n\tDeferredShaderMaterial.prototype.create = function () {\n\n\t\tvar uniforms = UniformsUtils.clone( this.params.uniforms );\n\n\t\tfor ( var uniformId in this.params.uniforms ) {\n\n\t\t\tvar originalUniform = this.params.uniforms[ uniformId ];\n\n\t\t\tif ( originalUniform.value instanceof Texture ) {\n\n\t\t\t\tuniforms[ uniformId ].value = originalUniform.value;\n\t\t\t\tuniforms[ uniformId ].value.needsUpdate = true;\n\n\t\t\t}\n\n\t\t\tuniforms[ uniformId ].semantic = originalUniform.semantic;\n\t\t\tuniforms[ uniformId ].node = originalUniform.node;\n\n\t\t}\n\n\t\tthis.params.uniforms = uniforms;\n\n\t\treturn new RawShaderMaterial( this.params );\n\n\t};\n\n\t/* GLTF PARSER */\n\n\tfunction GLTFParser( json, extensions, options ) {\n\n\t\tthis.json = json || {};\n\t\tthis.extensions = extensions || {};\n\t\tthis.options = options || {};\n\n\t\t// loader object cache\n\t\tthis.cache = new GLTFRegistry();\n\n\t}\n\n\tGLTFParser.prototype._withDependencies = function ( dependencies ) {\n\n\t\tvar _dependencies = {};\n\n\t\tfor ( var i = 0; i < dependencies.length; i ++ ) {\n\n\t\t\tvar dependency = dependencies[ i ];\n\t\t\tvar fnName = \"load\" + dependency.charAt( 0 ).toUpperCase() + dependency.slice( 1 );\n\n\t\t\tvar cached = this.cache.get( dependency );\n\n\t\t\tif ( cached !== undefined ) {\n\n\t\t\t\t_dependencies[ dependency ] = cached;\n\n\t\t\t} else if ( this[ fnName ] ) {\n\n\t\t\t\tvar fn = this[ fnName ]();\n\t\t\t\tthis.cache.add( dependency, fn );\n\n\t\t\t\t_dependencies[ dependency ] = fn;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn _each( _dependencies, function ( dependency ) {\n\n\t\t\treturn dependency;\n\n\t\t} );\n\n\t};\n\n\tGLTFParser.prototype.parse = function ( callback ) {\n\n\t\tvar json = this.json;\n\n\t\t// Clear the loader cache\n\t\tthis.cache.removeAll();\n\n\t\t// Fire the callback on complete\n\t\tthis._withDependencies( [\n\n\t\t\t\"scenes\",\n\t\t\t\"cameras\",\n\t\t\t\"animations\"\n\n\t\t] ).then( function ( dependencies ) {\n\n\t\t\tvar scenes = [];\n\n\t\t\tfor ( var name in dependencies.scenes ) {\n\n\t\t\t\tscenes.push( dependencies.scenes[ name ] );\n\n\t\t\t}\n\n\t\t\tvar scene = json.scene !== undefined ? dependencies.scenes[ json.scene ] : scenes[ 0 ];\n\n\t\t\tvar cameras = [];\n\n\t\t\tfor ( var name in dependencies.cameras ) {\n\n\t\t\t\tvar camera = dependencies.cameras[ name ];\n\t\t\t\tcameras.push( camera );\n\n\t\t\t}\n\n\t\t\tvar animations = [];\n\n\t\t\tfor ( var name in dependencies.animations ) {\n\n\t\t\t\tanimations.push( dependencies.animations[ name ] );\n\n\t\t\t}\n\n\t\t\tcallback( scene, scenes, cameras, animations );\n\n\t\t} );\n\n\t};\n\n\tGLTFParser.prototype.loadShaders = function () {\n\n\t\tvar json = this.json;\n\t\tvar extensions = this.extensions;\n\t\tvar options = this.options;\n\n\t\treturn this._withDependencies( [\n\n\t\t\t\"bufferViews\"\n\n\t\t] ).then( function ( dependencies ) {\n\n\t\t\treturn _each( json.shaders, function ( shader ) {\n\n\t\t\t\tif ( shader.extensions && shader.extensions[ EXTENSIONS.KHR_BINARY_GLTF ] ) {\n\n\t\t\t\t\treturn extensions[ EXTENSIONS.KHR_BINARY_GLTF ].loadShader( shader, dependencies.bufferViews );\n\n\t\t\t\t}\n\n\t\t\t\treturn new Promise( function ( resolve ) {\n\n\t\t\t\t\tvar loader = new FileLoader( options.manager );\n\t\t\t\t\tloader.setResponseType( 'text' );\n\t\t\t\t\tloader.load( resolveURL( shader.uri, options.path ), function ( shaderText ) {\n\n\t\t\t\t\t\tresolve( shaderText );\n\n\t\t\t\t\t} );\n\n\t\t\t\t} );\n\n\t\t\t} );\n\n\t\t} );\n\n\t};\n\n\tGLTFParser.prototype.loadBuffers = function () {\n\n\t\tvar json = this.json;\n\t\tvar extensions = this.extensions;\n\t\tvar options = this.options;\n\n\t\treturn _each( json.buffers, function ( buffer, name ) {\n\n\t\t\tif ( name === BINARY_EXTENSION_BUFFER_NAME ) {\n\n\t\t\t\treturn extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body;\n\n\t\t\t}\n\n\t\t\tif ( buffer.type === 'arraybuffer' || buffer.type === undefined ) {\n\n\t\t\t\treturn new Promise( function ( resolve ) {\n\n\t\t\t\t\tvar loader = new FileLoader( options.manager );\n\t\t\t\t\tloader.setResponseType( 'arraybuffer' );\n\t\t\t\t\tloader.load( resolveURL( buffer.uri, options.path ), function ( buffer ) {\n\n\t\t\t\t\t\tresolve( buffer );\n\n\t\t\t\t\t} );\n\n\t\t\t\t} );\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'THREE.LegacyGLTFLoader: ' + buffer.type + ' buffer type is not supported' );\n\n\t\t\t}\n\n\t\t} );\n\n\t};\n\n\tGLTFParser.prototype.loadBufferViews = function () {\n\n\t\tvar json = this.json;\n\n\t\treturn this._withDependencies( [\n\n\t\t\t\"buffers\"\n\n\t\t] ).then( function ( dependencies ) {\n\n\t\t\treturn _each( json.bufferViews, function ( bufferView ) {\n\n\t\t\t\tvar arraybuffer = dependencies.buffers[ bufferView.buffer ];\n\n\t\t\t\tvar byteLength = bufferView.byteLength !== undefined ? bufferView.byteLength : 0;\n\n\t\t\t\treturn arraybuffer.slice( bufferView.byteOffset, bufferView.byteOffset + byteLength );\n\n\t\t\t} );\n\n\t\t} );\n\n\t};\n\n\tGLTFParser.prototype.loadAccessors = function () {\n\n\t\tvar json = this.json;\n\n\t\treturn this._withDependencies( [\n\n\t\t\t\"bufferViews\"\n\n\t\t] ).then( function ( dependencies ) {\n\n\t\t\treturn _each( json.accessors, function ( accessor ) {\n\n\t\t\t\tvar arraybuffer = dependencies.bufferViews[ accessor.bufferView ];\n\t\t\t\tvar itemSize = WEBGL_TYPE_SIZES[ accessor.type ];\n\t\t\t\tvar TypedArray = WEBGL_COMPONENT_TYPES[ accessor.componentType ];\n\n\t\t\t\t// For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\n\t\t\t\tvar elementBytes = TypedArray.BYTES_PER_ELEMENT;\n\t\t\t\tvar itemBytes = elementBytes * itemSize;\n\n\t\t\t\t// The buffer is not interleaved if the stride is the item size in bytes.\n\t\t\t\tif ( accessor.byteStride && accessor.byteStride !== itemBytes ) {\n\n\t\t\t\t\t// Use the full buffer if it's interleaved.\n\t\t\t\t\tvar array = new TypedArray( arraybuffer );\n\n\t\t\t\t\t// Integer parameters to IB/IBA are in array elements, not bytes.\n\t\t\t\t\tvar ib = new InterleavedBuffer( array, accessor.byteStride / elementBytes );\n\n\t\t\t\t\treturn new InterleavedBufferAttribute( ib, itemSize, accessor.byteOffset / elementBytes );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tarray = new TypedArray( arraybuffer, accessor.byteOffset, accessor.count * itemSize );\n\n\t\t\t\t\treturn new BufferAttribute( array, itemSize );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} );\n\n\t};\n\n\tGLTFParser.prototype.loadTextures = function () {\n\n\t\tvar json = this.json;\n\t\tvar options = this.options;\n\n\t\treturn this._withDependencies( [\n\n\t\t\t\"bufferViews\"\n\n\t\t] ).then( function ( dependencies ) {\n\n\t\t\treturn _each( json.textures, function ( texture ) {\n\n\t\t\t\tif ( texture.source ) {\n\n\t\t\t\t\treturn new Promise( function ( resolve ) {\n\n\t\t\t\t\t\tvar source = json.images[ texture.source ];\n\t\t\t\t\t\tvar sourceUri = source.uri;\n\t\t\t\t\t\tvar isObjectURL = false;\n\n\t\t\t\t\t\tif ( source.extensions && source.extensions[ EXTENSIONS.KHR_BINARY_GLTF ] ) {\n\n\t\t\t\t\t\t\tvar metadata = source.extensions[ EXTENSIONS.KHR_BINARY_GLTF ];\n\t\t\t\t\t\t\tvar bufferView = dependencies.bufferViews[ metadata.bufferView ];\n\t\t\t\t\t\t\tvar blob = new Blob( [ bufferView ], { type: metadata.mimeType } );\n\t\t\t\t\t\t\tsourceUri = URL.createObjectURL( blob );\n\t\t\t\t\t\t\tisObjectURL = true;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar textureLoader = options.manager.getHandler( sourceUri );\n\n\t\t\t\t\t\tif ( textureLoader === null ) {\n\n\t\t\t\t\t\t\ttextureLoader = new TextureLoader( options.manager );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttextureLoader.setCrossOrigin( options.crossOrigin );\n\n\t\t\t\t\t\ttextureLoader.load( resolveURL( sourceUri, options.path ), function ( _texture ) {\n\n\t\t\t\t\t\t\tif ( isObjectURL ) URL.revokeObjectURL( sourceUri );\n\n\t\t\t\t\t\t\t_texture.flipY = false;\n\n\t\t\t\t\t\t\tif ( texture.name !== undefined ) _texture.name = texture.name;\n\n\t\t\t\t\t\t\t_texture.format = texture.format !== undefined ? WEBGL_TEXTURE_FORMATS[ texture.format ] : RGBAFormat;\n\n\t\t\t\t\t\t\tif ( texture.internalFormat !== undefined && _texture.format !== WEBGL_TEXTURE_FORMATS[ texture.internalFormat ] ) {\n\n\t\t\t\t\t\t\t\tconsole.warn( 'THREE.LegacyGLTFLoader: Three.js doesn\\'t support texture internalFormat which is different from texture format. ' +\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'internalFormat will be forced to be the same value as format.' );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t_texture.type = texture.type !== undefined ? WEBGL_TEXTURE_DATATYPES[ texture.type ] : UnsignedByteType;\n\n\t\t\t\t\t\t\tif ( texture.sampler ) {\n\n\t\t\t\t\t\t\t\tvar sampler = json.samplers[ texture.sampler ];\n\n\t\t\t\t\t\t\t\t_texture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || LinearFilter;\n\t\t\t\t\t\t\t\t_texture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || NearestMipmapLinearFilter;\n\t\t\t\t\t\t\t\t_texture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || RepeatWrapping;\n\t\t\t\t\t\t\t\t_texture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || RepeatWrapping;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve( _texture );\n\n\t\t\t\t\t\t}, undefined, function () {\n\n\t\t\t\t\t\t\tif ( isObjectURL ) URL.revokeObjectURL( sourceUri );\n\n\t\t\t\t\t\t\tresolve();\n\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} );\n\n\t};\n\n\tGLTFParser.prototype.loadMaterials = function () {\n\n\t\tvar json = this.json;\n\n\t\treturn this._withDependencies( [\n\n\t\t\t\"shaders\",\n\t\t\t\"textures\"\n\n\t\t] ).then( function ( dependencies ) {\n\n\t\t\treturn _each( json.materials, function ( material ) {\n\n\t\t\t\tvar materialType;\n\t\t\t\tvar materialValues = {};\n\t\t\t\tvar materialParams = {};\n\n\t\t\t\tvar khr_material;\n\n\t\t\t\tif ( material.extensions && material.extensions[ EXTENSIONS.KHR_MATERIALS_COMMON ] ) {\n\n\t\t\t\t\tkhr_material = material.extensions[ EXTENSIONS.KHR_MATERIALS_COMMON ];\n\n\t\t\t\t}\n\n\t\t\t\tif ( khr_material ) {\n\n\t\t\t\t\t// don't copy over unused values to avoid material warning spam\n\t\t\t\t\tvar keys = [ 'ambient', 'emission', 'transparent', 'transparency', 'doubleSided' ];\n\n\t\t\t\t\tswitch ( khr_material.technique ) {\n\n\t\t\t\t\t\tcase 'BLINN' :\n\t\t\t\t\t\tcase 'PHONG' :\n\t\t\t\t\t\t\tmaterialType = MeshPhongMaterial;\n\t\t\t\t\t\t\tkeys.push( 'diffuse', 'specular', 'shininess' );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'LAMBERT' :\n\t\t\t\t\t\t\tmaterialType = MeshLambertMaterial;\n\t\t\t\t\t\t\tkeys.push( 'diffuse' );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'CONSTANT' :\n\t\t\t\t\t\tdefault :\n\t\t\t\t\t\t\tmaterialType = MeshBasicMaterial;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tkeys.forEach( function ( v ) {\n\n\t\t\t\t\t\tif ( khr_material.values[ v ] !== undefined ) materialValues[ v ] = khr_material.values[ v ];\n\n\t\t\t\t\t} );\n\n\t\t\t\t\tif ( khr_material.doubleSided || materialValues.doubleSided ) {\n\n\t\t\t\t\t\tmaterialParams.side = DoubleSide;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( khr_material.transparent || materialValues.transparent ) {\n\n\t\t\t\t\t\tmaterialParams.transparent = true;\n\t\t\t\t\t\tmaterialParams.opacity = ( materialValues.transparency !== undefined ) ? materialValues.transparency : 1;\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( material.technique === undefined ) {\n\n\t\t\t\t\tmaterialType = MeshPhongMaterial;\n\n\t\t\t\t\tObject.assign( materialValues, material.values );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tmaterialType = DeferredShaderMaterial;\n\n\t\t\t\t\tvar technique = json.techniques[ material.technique ];\n\n\t\t\t\t\tmaterialParams.uniforms = {};\n\n\t\t\t\t\tvar program = json.programs[ technique.program ];\n\n\t\t\t\t\tif ( program ) {\n\n\t\t\t\t\t\tmaterialParams.fragmentShader = dependencies.shaders[ program.fragmentShader ];\n\n\t\t\t\t\t\tif ( ! materialParams.fragmentShader ) {\n\n\t\t\t\t\t\t\tconsole.warn( \"ERROR: Missing fragment shader definition:\", program.fragmentShader );\n\t\t\t\t\t\t\tmaterialType = MeshPhongMaterial;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar vertexShader = dependencies.shaders[ program.vertexShader ];\n\n\t\t\t\t\t\tif ( ! vertexShader ) {\n\n\t\t\t\t\t\t\tconsole.warn( \"ERROR: Missing vertex shader definition:\", program.vertexShader );\n\t\t\t\t\t\t\tmaterialType = MeshPhongMaterial;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// IMPORTANT: FIX VERTEX SHADER ATTRIBUTE DEFINITIONS\n\t\t\t\t\t\tmaterialParams.vertexShader = replaceTHREEShaderAttributes( vertexShader, technique );\n\n\t\t\t\t\t\tvar uniforms = technique.uniforms;\n\n\t\t\t\t\t\tfor ( var uniformId in uniforms ) {\n\n\t\t\t\t\t\t\tvar pname = uniforms[ uniformId ];\n\t\t\t\t\t\t\tvar shaderParam = technique.parameters[ pname ];\n\n\t\t\t\t\t\t\tvar ptype = shaderParam.type;\n\n\t\t\t\t\t\t\tif ( WEBGL_TYPE[ ptype ] ) {\n\n\t\t\t\t\t\t\t\tvar pcount = shaderParam.count;\n\t\t\t\t\t\t\t\tvar value;\n\n\t\t\t\t\t\t\t\tif ( material.values !== undefined ) value = material.values[ pname ];\n\n\t\t\t\t\t\t\t\tvar uvalue = new WEBGL_TYPE[ ptype ]();\n\t\t\t\t\t\t\t\tvar usemantic = shaderParam.semantic;\n\t\t\t\t\t\t\t\tvar unode = shaderParam.node;\n\n\t\t\t\t\t\t\t\tswitch ( ptype ) {\n\n\t\t\t\t\t\t\t\t\tcase WEBGL_CONSTANTS.FLOAT:\n\n\t\t\t\t\t\t\t\t\t\tuvalue = shaderParam.value;\n\n\t\t\t\t\t\t\t\t\t\tif ( pname == \"transparency\" ) {\n\n\t\t\t\t\t\t\t\t\t\t\tmaterialParams.transparent = true;\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif ( value !== undefined ) {\n\n\t\t\t\t\t\t\t\t\t\t\tuvalue = value;\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase WEBGL_CONSTANTS.FLOAT_VEC2:\n\t\t\t\t\t\t\t\t\tcase WEBGL_CONSTANTS.FLOAT_VEC3:\n\t\t\t\t\t\t\t\t\tcase WEBGL_CONSTANTS.FLOAT_VEC4:\n\t\t\t\t\t\t\t\t\tcase WEBGL_CONSTANTS.FLOAT_MAT3:\n\n\t\t\t\t\t\t\t\t\t\tif ( shaderParam && shaderParam.value ) {\n\n\t\t\t\t\t\t\t\t\t\t\tuvalue.fromArray( shaderParam.value );\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif ( value ) {\n\n\t\t\t\t\t\t\t\t\t\t\tuvalue.fromArray( value );\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase WEBGL_CONSTANTS.FLOAT_MAT2:\n\n\t\t\t\t\t\t\t\t\t\t// what to do?\n\t\t\t\t\t\t\t\t\t\tconsole.warn( \"FLOAT_MAT2 is not a supported uniform type\" );\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase WEBGL_CONSTANTS.FLOAT_MAT4:\n\n\t\t\t\t\t\t\t\t\t\tif ( pcount ) {\n\n\t\t\t\t\t\t\t\t\t\t\tuvalue = new Array( pcount );\n\n\t\t\t\t\t\t\t\t\t\t\tfor ( var mi = 0; mi < pcount; mi ++ ) {\n\n\t\t\t\t\t\t\t\t\t\t\t\tuvalue[ mi ] = new WEBGL_TYPE[ ptype ]();\n\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tif ( shaderParam && shaderParam.value ) {\n\n\t\t\t\t\t\t\t\t\t\t\t\tvar m4v = shaderParam.value;\n\t\t\t\t\t\t\t\t\t\t\t\tuvalue.fromArray( m4v );\n\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tif ( value ) {\n\n\t\t\t\t\t\t\t\t\t\t\t\tuvalue.fromArray( value );\n\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t\t\t\tif ( shaderParam && shaderParam.value ) {\n\n\t\t\t\t\t\t\t\t\t\t\t\tvar m4 = shaderParam.value;\n\t\t\t\t\t\t\t\t\t\t\t\tuvalue.fromArray( m4 );\n\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tif ( value ) {\n\n\t\t\t\t\t\t\t\t\t\t\t\tuvalue.fromArray( value );\n\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase WEBGL_CONSTANTS.SAMPLER_2D:\n\n\t\t\t\t\t\t\t\t\t\tif ( value !== undefined ) {\n\n\t\t\t\t\t\t\t\t\t\t\tuvalue = dependencies.textures[ value ];\n\n\t\t\t\t\t\t\t\t\t\t} else if ( shaderParam.value !== undefined ) {\n\n\t\t\t\t\t\t\t\t\t\t\tuvalue = dependencies.textures[ shaderParam.value ];\n\n\t\t\t\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t\t\t\tuvalue = null;\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tmaterialParams.uniforms[ uniformId ] = {\n\t\t\t\t\t\t\t\t\tvalue: uvalue,\n\t\t\t\t\t\t\t\t\tsemantic: usemantic,\n\t\t\t\t\t\t\t\t\tnode: unode\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\tthrow new Error( \"Unknown shader uniform param type: \" + ptype );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar states = technique.states || {};\n\t\t\t\t\t\tvar enables = states.enable || [];\n\t\t\t\t\t\tvar functions = states.functions || {};\n\n\t\t\t\t\t\tvar enableCullFace = false;\n\t\t\t\t\t\tvar enableDepthTest = false;\n\t\t\t\t\t\tvar enableBlend = false;\n\n\t\t\t\t\t\tfor ( var i = 0, il = enables.length; i < il; i ++ ) {\n\n\t\t\t\t\t\t\tvar enable = enables[ i ];\n\n\t\t\t\t\t\t\tswitch ( STATES_ENABLES[ enable ] ) {\n\n\t\t\t\t\t\t\t\tcase 'CULL_FACE':\n\n\t\t\t\t\t\t\t\t\tenableCullFace = true;\n\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 'DEPTH_TEST':\n\n\t\t\t\t\t\t\t\t\tenableDepthTest = true;\n\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 'BLEND':\n\n\t\t\t\t\t\t\t\t\tenableBlend = true;\n\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t// TODO: implement\n\t\t\t\t\t\t\t\tcase 'SCISSOR_TEST':\n\t\t\t\t\t\t\t\tcase 'POLYGON_OFFSET_FILL':\n\t\t\t\t\t\t\t\tcase 'SAMPLE_ALPHA_TO_COVERAGE':\n\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\t\t\tthrow new Error( \"Unknown technique.states.enable: \" + enable );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( enableCullFace ) {\n\n\t\t\t\t\t\t\tmaterialParams.side = functions.cullFace !== undefined ? WEBGL_SIDES[ functions.cullFace ] : FrontSide;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tmaterialParams.side = DoubleSide;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmaterialParams.depthTest = enableDepthTest;\n\t\t\t\t\t\tmaterialParams.depthFunc = functions.depthFunc !== undefined ? WEBGL_DEPTH_FUNCS[ functions.depthFunc ] : LessDepth;\n\t\t\t\t\t\tmaterialParams.depthWrite = functions.depthMask !== undefined ? functions.depthMask[ 0 ] : true;\n\n\t\t\t\t\t\tmaterialParams.blending = enableBlend ? CustomBlending : NoBlending;\n\t\t\t\t\t\tmaterialParams.transparent = enableBlend;\n\n\t\t\t\t\t\tvar blendEquationSeparate = functions.blendEquationSeparate;\n\n\t\t\t\t\t\tif ( blendEquationSeparate !== undefined ) {\n\n\t\t\t\t\t\t\tmaterialParams.blendEquation = WEBGL_BLEND_EQUATIONS[ blendEquationSeparate[ 0 ] ];\n\t\t\t\t\t\t\tmaterialParams.blendEquationAlpha = WEBGL_BLEND_EQUATIONS[ blendEquationSeparate[ 1 ] ];\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tmaterialParams.blendEquation = AddEquation;\n\t\t\t\t\t\t\tmaterialParams.blendEquationAlpha = AddEquation;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar blendFuncSeparate = functions.blendFuncSeparate;\n\n\t\t\t\t\t\tif ( blendFuncSeparate !== undefined ) {\n\n\t\t\t\t\t\t\tmaterialParams.blendSrc = WEBGL_BLEND_FUNCS[ blendFuncSeparate[ 0 ] ];\n\t\t\t\t\t\t\tmaterialParams.blendDst = WEBGL_BLEND_FUNCS[ blendFuncSeparate[ 1 ] ];\n\t\t\t\t\t\t\tmaterialParams.blendSrcAlpha = WEBGL_BLEND_FUNCS[ blendFuncSeparate[ 2 ] ];\n\t\t\t\t\t\t\tmaterialParams.blendDstAlpha = WEBGL_BLEND_FUNCS[ blendFuncSeparate[ 3 ] ];\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tmaterialParams.blendSrc = OneFactor;\n\t\t\t\t\t\t\tmaterialParams.blendDst = ZeroFactor;\n\t\t\t\t\t\t\tmaterialParams.blendSrcAlpha = OneFactor;\n\t\t\t\t\t\t\tmaterialParams.blendDstAlpha = ZeroFactor;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( Array.isArray( materialValues.diffuse ) ) {\n\n\t\t\t\t\tmaterialParams.color = new Color().fromArray( materialValues.diffuse );\n\n\t\t\t\t} else if ( typeof ( materialValues.diffuse ) === 'string' ) {\n\n\t\t\t\t\tmaterialParams.map = dependencies.textures[ materialValues.diffuse ];\n\n\t\t\t\t}\n\n\t\t\t\tdelete materialParams.diffuse;\n\n\t\t\t\tif ( typeof ( materialValues.reflective ) === 'string' ) {\n\n\t\t\t\t\tmaterialParams.envMap = dependencies.textures[ materialValues.reflective ];\n\n\t\t\t\t}\n\n\t\t\t\tif ( typeof ( materialValues.bump ) === 'string' ) {\n\n\t\t\t\t\tmaterialParams.bumpMap = dependencies.textures[ materialValues.bump ];\n\n\t\t\t\t}\n\n\t\t\t\tif ( Array.isArray( materialValues.emission ) ) {\n\n\t\t\t\t\tif ( materialType === MeshBasicMaterial ) {\n\n\t\t\t\t\t\tmaterialParams.color = new Color().fromArray( materialValues.emission );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tmaterialParams.emissive = new Color().fromArray( materialValues.emission );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( typeof ( materialValues.emission ) === 'string' ) {\n\n\t\t\t\t\tif ( materialType === MeshBasicMaterial ) {\n\n\t\t\t\t\t\tmaterialParams.map = dependencies.textures[ materialValues.emission ];\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tmaterialParams.emissiveMap = dependencies.textures[ materialValues.emission ];\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif ( Array.isArray( materialValues.specular ) ) {\n\n\t\t\t\t\tmaterialParams.specular = new Color().fromArray( materialValues.specular );\n\n\t\t\t\t} else if ( typeof ( materialValues.specular ) === 'string' ) {\n\n\t\t\t\t\tmaterialParams.specularMap = dependencies.textures[ materialValues.specular ];\n\n\t\t\t\t}\n\n\t\t\t\tif ( materialValues.shininess !== undefined ) {\n\n\t\t\t\t\tmaterialParams.shininess = materialValues.shininess;\n\n\t\t\t\t}\n\n\t\t\t\tvar _material = new materialType( materialParams );\n\t\t\t\tif ( material.name !== undefined ) _material.name = material.name;\n\n\t\t\t\treturn _material;\n\n\t\t\t} );\n\n\t\t} );\n\n\t};\n\n\tGLTFParser.prototype.loadMeshes = function () {\n\n\t\tvar json = this.json;\n\n\t\treturn this._withDependencies( [\n\n\t\t\t\"accessors\",\n\t\t\t\"materials\"\n\n\t\t] ).then( function ( dependencies ) {\n\n\t\t\treturn _each( json.meshes, function ( mesh ) {\n\n\t\t\t\tvar group = new Group();\n\t\t\t\tif ( mesh.name !== undefined ) group.name = mesh.name;\n\n\t\t\t\tif ( mesh.extras ) group.userData = mesh.extras;\n\n\t\t\t\tvar primitives = mesh.primitives || [];\n\n\t\t\t\tfor ( var name in primitives ) {\n\n\t\t\t\t\tvar primitive = primitives[ name ];\n\n\t\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES || primitive.mode === undefined ) {\n\n\t\t\t\t\t\tvar geometry = new BufferGeometry();\n\n\t\t\t\t\t\tvar attributes = primitive.attributes;\n\n\t\t\t\t\t\tfor ( var attributeId in attributes ) {\n\n\t\t\t\t\t\t\tvar attributeEntry = attributes[ attributeId ];\n\n\t\t\t\t\t\t\tif ( ! attributeEntry ) return;\n\n\t\t\t\t\t\t\tvar bufferAttribute = dependencies.accessors[ attributeEntry ];\n\n\t\t\t\t\t\t\tswitch ( attributeId ) {\n\n\t\t\t\t\t\t\t\tcase 'POSITION':\n\t\t\t\t\t\t\t\t\tgeometry.setAttribute( 'position', bufferAttribute );\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 'NORMAL':\n\t\t\t\t\t\t\t\t\tgeometry.setAttribute( 'normal', bufferAttribute );\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 'TEXCOORD_0':\n\t\t\t\t\t\t\t\tcase 'TEXCOORD0':\n\t\t\t\t\t\t\t\tcase 'TEXCOORD':\n\t\t\t\t\t\t\t\t\tgeometry.setAttribute( 'uv', bufferAttribute );\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 'TEXCOORD_1':\n\t\t\t\t\t\t\t\t\tgeometry.setAttribute( 'uv2', bufferAttribute );\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 'COLOR_0':\n\t\t\t\t\t\t\t\tcase 'COLOR0':\n\t\t\t\t\t\t\t\tcase 'COLOR':\n\t\t\t\t\t\t\t\t\tgeometry.setAttribute( 'color', bufferAttribute );\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 'WEIGHT':\n\t\t\t\t\t\t\t\t\tgeometry.setAttribute( 'skinWeight', bufferAttribute );\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 'JOINT':\n\t\t\t\t\t\t\t\t\tgeometry.setAttribute( 'skinIndex', bufferAttribute );\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\t\t\tif ( ! primitive.material ) break;\n\n\t\t\t\t\t\t\t\t\tvar material = json.materials[ primitive.material ];\n\n\t\t\t\t\t\t\t\t\tif ( ! material.technique ) break;\n\n\t\t\t\t\t\t\t\t\tvar parameters = json.techniques[ material.technique ].parameters || {};\n\n\t\t\t\t\t\t\t\t\tfor ( var attributeName in parameters ) {\n\n\t\t\t\t\t\t\t\t\t\tif ( parameters[ attributeName ][ 'semantic' ] === attributeId ) {\n\n\t\t\t\t\t\t\t\t\t\t\tgeometry.setAttribute( attributeName, bufferAttribute );\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( primitive.indices ) {\n\n\t\t\t\t\t\t\tgeometry.setIndex( dependencies.accessors[ primitive.indices ] );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar material = dependencies.materials !== undefined ? dependencies.materials[ primitive.material ] : createDefaultMaterial();\n\n\t\t\t\t\t\tvar meshNode = new Mesh( geometry, material );\n\t\t\t\t\t\tmeshNode.castShadow = true;\n\t\t\t\t\t\tmeshNode.name = ( name === \"0\" ? group.name : group.name + name );\n\n\t\t\t\t\t\tif ( primitive.extras ) meshNode.userData = primitive.extras;\n\n\t\t\t\t\t\tgroup.add( meshNode );\n\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {\n\n\t\t\t\t\t\tvar geometry = new BufferGeometry();\n\n\t\t\t\t\t\tvar attributes = primitive.attributes;\n\n\t\t\t\t\t\tfor ( var attributeId in attributes ) {\n\n\t\t\t\t\t\t\tvar attributeEntry = attributes[ attributeId ];\n\n\t\t\t\t\t\t\tif ( ! attributeEntry ) return;\n\n\t\t\t\t\t\t\tvar bufferAttribute = dependencies.accessors[ attributeEntry ];\n\n\t\t\t\t\t\t\tswitch ( attributeId ) {\n\n\t\t\t\t\t\t\t\tcase 'POSITION':\n\t\t\t\t\t\t\t\t\tgeometry.setAttribute( 'position', bufferAttribute );\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 'COLOR_0':\n\t\t\t\t\t\t\t\tcase 'COLOR0':\n\t\t\t\t\t\t\t\tcase 'COLOR':\n\t\t\t\t\t\t\t\t\tgeometry.setAttribute( 'color', bufferAttribute );\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar material = dependencies.materials[ primitive.material ];\n\n\t\t\t\t\t\tvar meshNode;\n\n\t\t\t\t\t\tif ( primitive.indices ) {\n\n\t\t\t\t\t\t\tgeometry.setIndex( dependencies.accessors[ primitive.indices ] );\n\n\t\t\t\t\t\t\tmeshNode = new LineSegments( geometry, material );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tmeshNode = new Line( geometry, material );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmeshNode.name = ( name === \"0\" ? group.name : group.name + name );\n\n\t\t\t\t\t\tif ( primitive.extras ) meshNode.userData = primitive.extras;\n\n\t\t\t\t\t\tgroup.add( meshNode );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconsole.warn( \"Only triangular and line primitives are supported\" );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\treturn group;\n\n\t\t\t} );\n\n\t\t} );\n\n\t};\n\n\tGLTFParser.prototype.loadCameras = function () {\n\n\t\tvar json = this.json;\n\n\t\treturn _each( json.cameras, function ( camera ) {\n\n\t\t\tif ( camera.type == \"perspective\" && camera.perspective ) {\n\n\t\t\t\tvar yfov = camera.perspective.yfov;\n\t\t\t\tvar aspectRatio = camera.perspective.aspectRatio !== undefined ? camera.perspective.aspectRatio : 1;\n\n\t\t\t\t// According to COLLADA spec...\n\t\t\t\t// aspectRatio = xfov / yfov\n\t\t\t\tvar xfov = yfov * aspectRatio;\n\n\t\t\t\tvar _camera = new PerspectiveCamera( _Math.radToDeg( xfov ), aspectRatio, camera.perspective.znear || 1, camera.perspective.zfar || 2e6 );\n\t\t\t\tif ( camera.name !== undefined ) _camera.name = camera.name;\n\n\t\t\t\tif ( camera.extras ) _camera.userData = camera.extras;\n\n\t\t\t\treturn _camera;\n\n\t\t\t} else if ( camera.type == \"orthographic\" && camera.orthographic ) {\n\n\t\t\t\tvar _camera = new OrthographicCamera( window.innerWidth / - 2, window.innerWidth / 2, window.innerHeight / 2, window.innerHeight / - 2, camera.orthographic.znear, camera.orthographic.zfar );\n\t\t\t\tif ( camera.name !== undefined ) _camera.name = camera.name;\n\n\t\t\t\tif ( camera.extras ) _camera.userData = camera.extras;\n\n\t\t\t\treturn _camera;\n\n\t\t\t}\n\n\t\t} );\n\n\t};\n\n\tGLTFParser.prototype.loadSkins = function () {\n\n\t\tvar json = this.json;\n\n\t\treturn this._withDependencies( [\n\n\t\t\t\"accessors\"\n\n\t\t] ).then( function ( dependencies ) {\n\n\t\t\treturn _each( json.skins, function ( skin ) {\n\n\t\t\t\tvar bindShapeMatrix = new Matrix4();\n\n\t\t\t\tif ( skin.bindShapeMatrix !== undefined ) bindShapeMatrix.fromArray( skin.bindShapeMatrix );\n\n\t\t\t\tvar _skin = {\n\t\t\t\t\tbindShapeMatrix: bindShapeMatrix,\n\t\t\t\t\tjointNames: skin.jointNames,\n\t\t\t\t\tinverseBindMatrices: dependencies.accessors[ skin.inverseBindMatrices ]\n\t\t\t\t};\n\n\t\t\t\treturn _skin;\n\n\t\t\t} );\n\n\t\t} );\n\n\t};\n\n\tGLTFParser.prototype.loadAnimations = function () {\n\n\t\tvar json = this.json;\n\n\t\treturn this._withDependencies( [\n\n\t\t\t\"accessors\",\n\t\t\t\"nodes\"\n\n\t\t] ).then( function ( dependencies ) {\n\n\t\t\treturn _each( json.animations, function ( animation, animationId ) {\n\n\t\t\t\tvar tracks = [];\n\n\t\t\t\tfor ( var channelId in animation.channels ) {\n\n\t\t\t\t\tvar channel = animation.channels[ channelId ];\n\t\t\t\t\tvar sampler = animation.samplers[ channel.sampler ];\n\n\t\t\t\t\tif ( sampler ) {\n\n\t\t\t\t\t\tvar target = channel.target;\n\t\t\t\t\t\tvar name = target.id;\n\t\t\t\t\t\tvar input = animation.parameters !== undefined ? animation.parameters[ sampler.input ] : sampler.input;\n\t\t\t\t\t\tvar output = animation.parameters !== undefined ? animation.parameters[ sampler.output ] : sampler.output;\n\n\t\t\t\t\t\tvar inputAccessor = dependencies.accessors[ input ];\n\t\t\t\t\t\tvar outputAccessor = dependencies.accessors[ output ];\n\n\t\t\t\t\t\tvar node = dependencies.nodes[ name ];\n\n\t\t\t\t\t\tif ( node ) {\n\n\t\t\t\t\t\t\tnode.updateMatrix();\n\t\t\t\t\t\t\tnode.matrixAutoUpdate = true;\n\n\t\t\t\t\t\t\tvar TypedKeyframeTrack = PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.rotation\n\t\t\t\t\t\t\t\t? QuaternionKeyframeTrack\n\t\t\t\t\t\t\t\t: VectorKeyframeTrack;\n\n\t\t\t\t\t\t\tvar targetName = node.name ? node.name : node.uuid;\n\t\t\t\t\t\t\tvar interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : InterpolateLinear;\n\n\t\t\t\t\t\t\t// KeyframeTrack.optimize() will modify given 'times' and 'values'\n\t\t\t\t\t\t\t// buffers before creating a truncated copy to keep. Because buffers may\n\t\t\t\t\t\t\t// be reused by other tracks, make copies here.\n\t\t\t\t\t\t\ttracks.push( new TypedKeyframeTrack(\n\t\t\t\t\t\t\t\ttargetName + '.' + PATH_PROPERTIES[ target.path ],\n\t\t\t\t\t\t\t\tAnimationUtils.arraySlice( inputAccessor.array, 0 ),\n\t\t\t\t\t\t\t\tAnimationUtils.arraySlice( outputAccessor.array, 0 ),\n\t\t\t\t\t\t\t\tinterpolation\n\t\t\t\t\t\t\t) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tvar name = animation.name !== undefined ? animation.name : \"animation_\" + animationId;\n\n\t\t\t\treturn new AnimationClip( name, undefined, tracks );\n\n\t\t\t} );\n\n\t\t} );\n\n\t};\n\n\tGLTFParser.prototype.loadNodes = function () {\n\n\t\tvar json = this.json;\n\t\tvar extensions = this.extensions;\n\t\tvar scope = this;\n\n\t\treturn _each( json.nodes, function ( node ) {\n\n\t\t\tvar matrix = new Matrix4();\n\n\t\t\tvar _node;\n\n\t\t\tif ( node.jointName ) {\n\n\t\t\t\t_node = new Bone();\n\t\t\t\t_node.name = node.name !== undefined ? node.name : node.jointName;\n\t\t\t\t_node.jointName = node.jointName;\n\n\t\t\t} else {\n\n\t\t\t\t_node = new Object3D();\n\t\t\t\tif ( node.name !== undefined ) _node.name = node.name;\n\n\t\t\t}\n\n\t\t\tif ( node.extras ) _node.userData = node.extras;\n\n\t\t\tif ( node.matrix !== undefined ) {\n\n\t\t\t\tmatrix.fromArray( node.matrix );\n\t\t\t\t_node.applyMatrix( matrix );\n\n\t\t\t} else {\n\n\t\t\t\tif ( node.translation !== undefined ) {\n\n\t\t\t\t\t_node.position.fromArray( node.translation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( node.rotation !== undefined ) {\n\n\t\t\t\t\t_node.quaternion.fromArray( node.rotation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( node.scale !== undefined ) {\n\n\t\t\t\t\t_node.scale.fromArray( node.scale );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn _node;\n\n\t\t} ).then( function ( __nodes ) {\n\n\t\t\treturn scope._withDependencies( [\n\n\t\t\t\t\"meshes\",\n\t\t\t\t\"skins\",\n\t\t\t\t\"cameras\"\n\n\t\t\t] ).then( function ( dependencies ) {\n\n\t\t\t\treturn _each( __nodes, function ( _node, nodeId ) {\n\n\t\t\t\t\tvar node = json.nodes[ nodeId ];\n\n\t\t\t\t\tif ( node.meshes !== undefined ) {\n\n\t\t\t\t\t\tfor ( var meshId in node.meshes ) {\n\n\t\t\t\t\t\t\tvar mesh = node.meshes[ meshId ];\n\t\t\t\t\t\t\tvar group = dependencies.meshes[ mesh ];\n\n\t\t\t\t\t\t\tif ( group === undefined ) {\n\n\t\t\t\t\t\t\t\tconsole.warn( 'LegacyGLTFLoader: Couldn\\'t find node \"' + mesh + '\".' );\n\t\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfor ( var childrenId in group.children ) {\n\n\t\t\t\t\t\t\t\tvar child = group.children[ childrenId ];\n\n\t\t\t\t\t\t\t\t// clone Mesh to add to _node\n\n\t\t\t\t\t\t\t\tvar originalMaterial = child.material;\n\t\t\t\t\t\t\t\tvar originalGeometry = child.geometry;\n\t\t\t\t\t\t\t\tvar originalUserData = child.userData;\n\t\t\t\t\t\t\t\tvar originalName = child.name;\n\n\t\t\t\t\t\t\t\tvar material;\n\n\t\t\t\t\t\t\t\tif ( originalMaterial.isDeferredShaderMaterial ) {\n\n\t\t\t\t\t\t\t\t\toriginalMaterial = material = originalMaterial.create();\n\n\t\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t\tmaterial = originalMaterial;\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tswitch ( child.type ) {\n\n\t\t\t\t\t\t\t\t\tcase 'LineSegments':\n\t\t\t\t\t\t\t\t\t\tchild = new LineSegments( originalGeometry, material );\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase 'LineLoop':\n\t\t\t\t\t\t\t\t\t\tchild = new LineLoop( originalGeometry, material );\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase 'Line':\n\t\t\t\t\t\t\t\t\t\tchild = new Line( originalGeometry, material );\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\tchild = new Mesh( originalGeometry, material );\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tchild.castShadow = true;\n\t\t\t\t\t\t\t\tchild.userData = originalUserData;\n\t\t\t\t\t\t\t\tchild.name = originalName;\n\n\t\t\t\t\t\t\t\tvar skinEntry;\n\n\t\t\t\t\t\t\t\tif ( node.skin ) {\n\n\t\t\t\t\t\t\t\t\tskinEntry = dependencies.skins[ node.skin ];\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Replace Mesh with SkinnedMesh in library\n\t\t\t\t\t\t\t\tif ( skinEntry ) {\n\n\t\t\t\t\t\t\t\t\tvar getJointNode = function ( jointId ) {\n\n\t\t\t\t\t\t\t\t\t\tvar keys = Object.keys( __nodes );\n\n\t\t\t\t\t\t\t\t\t\tfor ( var i = 0, il = keys.length; i < il; i ++ ) {\n\n\t\t\t\t\t\t\t\t\t\t\tvar n = __nodes[ keys[ i ] ];\n\n\t\t\t\t\t\t\t\t\t\t\tif ( n.jointName === jointId ) return n;\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\treturn null;\n\n\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\tvar geometry = originalGeometry;\n\t\t\t\t\t\t\t\t\tvar material = originalMaterial;\n\t\t\t\t\t\t\t\t\tmaterial.skinning = true;\n\n\t\t\t\t\t\t\t\t\tchild = new SkinnedMesh( geometry, material );\n\t\t\t\t\t\t\t\t\tchild.castShadow = true;\n\t\t\t\t\t\t\t\t\tchild.userData = originalUserData;\n\t\t\t\t\t\t\t\t\tchild.name = originalName;\n\n\t\t\t\t\t\t\t\t\tvar bones = [];\n\t\t\t\t\t\t\t\t\tvar boneInverses = [];\n\n\t\t\t\t\t\t\t\t\tfor ( var i = 0, l = skinEntry.jointNames.length; i < l; i ++ ) {\n\n\t\t\t\t\t\t\t\t\t\tvar jointId = skinEntry.jointNames[ i ];\n\t\t\t\t\t\t\t\t\t\tvar jointNode = getJointNode( jointId );\n\n\t\t\t\t\t\t\t\t\t\tif ( jointNode ) {\n\n\t\t\t\t\t\t\t\t\t\t\tbones.push( jointNode );\n\n\t\t\t\t\t\t\t\t\t\t\tvar m = skinEntry.inverseBindMatrices.array;\n\t\t\t\t\t\t\t\t\t\t\tvar mat = new Matrix4().fromArray( m, i * 16 );\n\t\t\t\t\t\t\t\t\t\t\tboneInverses.push( mat );\n\n\t\t\t\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t\t\t\tconsole.warn( \"WARNING: joint: '\" + jointId + \"' could not be found\" );\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tchild.bind( new Skeleton( bones, boneInverses ), skinEntry.bindShapeMatrix );\n\n\t\t\t\t\t\t\t\t\tvar buildBoneGraph = function ( parentJson, parentObject, property ) {\n\n\t\t\t\t\t\t\t\t\t\tvar children = parentJson[ property ];\n\n\t\t\t\t\t\t\t\t\t\tif ( children === undefined ) return;\n\n\t\t\t\t\t\t\t\t\t\tfor ( var i = 0, il = children.length; i < il; i ++ ) {\n\n\t\t\t\t\t\t\t\t\t\t\tvar nodeId = children[ i ];\n\t\t\t\t\t\t\t\t\t\t\tvar bone = __nodes[ nodeId ];\n\t\t\t\t\t\t\t\t\t\t\tvar boneJson = json.nodes[ nodeId ];\n\n\t\t\t\t\t\t\t\t\t\t\tif ( bone !== undefined && bone.isBone === true && boneJson !== undefined ) {\n\n\t\t\t\t\t\t\t\t\t\t\t\tparentObject.add( bone );\n\t\t\t\t\t\t\t\t\t\t\t\tbuildBoneGraph( boneJson, bone, 'children' );\n\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\tbuildBoneGraph( node, child, 'skeletons' );\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t_node.add( child );\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( node.camera !== undefined ) {\n\n\t\t\t\t\t\tvar camera = dependencies.cameras[ node.camera ];\n\n\t\t\t\t\t\t_node.add( camera );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( node.extensions\n\t\t\t\t\t\t\t && node.extensions[ EXTENSIONS.KHR_MATERIALS_COMMON ]\n\t\t\t\t\t\t\t && node.extensions[ EXTENSIONS.KHR_MATERIALS_COMMON ].light ) {\n\n\t\t\t\t\t\tvar extensionLights = extensions[ EXTENSIONS.KHR_MATERIALS_COMMON ].lights;\n\t\t\t\t\t\tvar light = extensionLights[ node.extensions[ EXTENSIONS.KHR_MATERIALS_COMMON ].light ];\n\n\t\t\t\t\t\t_node.add( light );\n\n\t\t\t\t\t}\n\n\t\t\t\t\treturn _node;\n\n\t\t\t\t} );\n\n\t\t\t} );\n\n\t\t} );\n\n\t};\n\n\tGLTFParser.prototype.loadScenes = function () {\n\n\t\tvar json = this.json;\n\n\t\t// scene node hierachy builder\n\n\t\tfunction buildNodeHierachy( nodeId, parentObject, allNodes ) {\n\n\t\t\tvar _node = allNodes[ nodeId ];\n\t\t\tparentObject.add( _node );\n\n\t\t\tvar node = json.nodes[ nodeId ];\n\n\t\t\tif ( node.children ) {\n\n\t\t\t\tvar children = node.children;\n\n\t\t\t\tfor ( var i = 0, l = children.length; i < l; i ++ ) {\n\n\t\t\t\t\tvar child = children[ i ];\n\t\t\t\t\tbuildNodeHierachy( child, _node, allNodes );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this._withDependencies( [\n\n\t\t\t\"nodes\"\n\n\t\t] ).then( function ( dependencies ) {\n\n\t\t\treturn _each( json.scenes, function ( scene ) {\n\n\t\t\t\tvar _scene = new Scene();\n\t\t\t\tif ( scene.name !== undefined ) _scene.name = scene.name;\n\n\t\t\t\tif ( scene.extras ) _scene.userData = scene.extras;\n\n\t\t\t\tvar nodes = scene.nodes || [];\n\n\t\t\t\tfor ( var i = 0, l = nodes.length; i < l; i ++ ) {\n\n\t\t\t\t\tvar nodeId = nodes[ i ];\n\t\t\t\t\tbuildNodeHierachy( nodeId, _scene, dependencies.nodes );\n\n\t\t\t\t}\n\n\t\t\t\t_scene.traverse( function ( child ) {\n\n\t\t\t\t\t// Register raw material meshes with LegacyGLTFLoader.Shaders\n\t\t\t\t\tif ( child.material && child.material.isRawShaderMaterial ) {\n\n\t\t\t\t\t\tchild.gltfShader = new GLTFShader( child, dependencies.nodes );\n\t\t\t\t\t\tchild.onBeforeRender = function ( renderer, scene, camera ) {\n\n\t\t\t\t\t\t\tthis.gltfShader.update( scene, camera );\n\n\t\t\t\t\t\t};\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\treturn _scene;\n\n\t\t\t} );\n\n\t\t} );\n\n\t};\n\n\treturn LegacyGLTFLoader;\n\n} )();\n\nexport { LegacyGLTFLoader };\n"]}