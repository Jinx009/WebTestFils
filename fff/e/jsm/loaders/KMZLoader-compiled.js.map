{"version":3,"sources":["KMZLoader.js"],"names":[],"mappings":"AAAA;;;;AAIA,SACC,UADD,EAEC,KAFD,EAGC,MAHD,EAIC,cAJD,QAKO,gCALP;AAMA,SAAS,aAAT,QAA8B,6BAA9B;;AAEA,IAAI,YAAY,UAAW,OAAX,EAAqB;;AAEpC,QAAO,IAAP,CAAa,IAAb,EAAmB,OAAnB;AAEA,CAJD;;AAMA,UAAU,SAAV,GAAsB,OAAO,MAAP,CAAe,OAAO,MAAP,CAAe,OAAO,SAAtB,CAAf,EAAkD;;AAEvE,cAAa,SAF0D;;AAIvE,OAAM,UAAW,GAAX,EAAgB,MAAhB,EAAwB,UAAxB,EAAoC,OAApC,EAA8C;;AAEnD,MAAI,QAAQ,IAAZ;;AAEA,MAAI,SAAS,IAAI,UAAJ,CAAgB,MAAM,OAAtB,CAAb;AACA,SAAO,OAAP,CAAgB,MAAM,IAAtB;AACA,SAAO,eAAP,CAAwB,aAAxB;AACA,SAAO,IAAP,CAAa,GAAb,EAAkB,UAAW,IAAX,EAAkB;;AAEnC,UAAQ,MAAM,KAAN,CAAa,IAAb,CAAR;AAEA,GAJD,EAIG,UAJH,EAIe,OAJf;AAMA,EAjBsE;;AAmBvE,QAAO,UAAW,IAAX,EAAkB;;AAExB,WAAS,QAAT,CAAmB,GAAnB,EAAyB;;AAExB,QAAM,IAAI,IAAV,IAAkB,IAAI,KAAtB,EAA8B;;AAE7B,QAAK,KAAK,MAAL,CAAa,CAAE,IAAI,MAAnB,MAAgC,GAArC,EAA2C;;AAE1C,YAAO,IAAI,KAAJ,CAAW,IAAX,CAAP;AAEA;AAED;AAED;;AAED,MAAI,UAAU,IAAI,cAAJ,EAAd;AACA,UAAQ,cAAR,CAAwB,UAAW,GAAX,EAAiB;;AAExC,OAAI,QAAQ,SAAU,GAAV,CAAZ;;AAEA,OAAK,KAAL,EAAa;;AAEZ,YAAQ,GAAR,CAAa,SAAb,EAAwB,GAAxB;;AAEA,QAAI,OAAO,IAAI,IAAJ,CAAU,CAAE,MAAM,aAAN,EAAF,CAAV,EAAqC,EAAE,MAAM,0BAAR,EAArC,CAAX;AACA,WAAO,IAAI,eAAJ,CAAqB,IAArB,CAAP;AAEA;;AAED,UAAO,GAAP;AAEA,GAfD;;AAiBA;;AAEA,MAAI,MAAM,IAAI,KAAJ,CAAW,IAAX,CAAV,CApCwB,CAoCK;;AAE7B,MAAK,IAAI,KAAJ,CAAW,SAAX,CAAL,EAA8B;;AAE7B,OAAI,MAAM,IAAI,SAAJ,GAAgB,eAAhB,CAAiC,IAAI,KAAJ,CAAW,SAAX,EAAuB,MAAvB,EAAjC,EAAkE,iBAAlE,CAAV;;AAEA,OAAI,QAAQ,IAAI,aAAJ,CAAmB,2BAAnB,CAAZ;;AAEA,OAAK,KAAL,EAAa;;AAEZ,QAAI,SAAS,IAAI,aAAJ,CAAmB,OAAnB,CAAb;AACA,WAAO,OAAO,KAAP,CAAc,IAAI,KAAJ,CAAW,MAAM,WAAjB,EAA+B,MAA/B,EAAd,CAAP;AAEA;AAED,GAbD,MAaO;;AAEN,WAAQ,IAAR,CAAc,kCAAd;;AAEA,QAAM,IAAI,IAAV,IAAkB,IAAI,KAAtB,EAA8B;;AAE7B,QAAI,YAAY,KAAK,KAAL,CAAY,GAAZ,EAAkB,GAAlB,GAAwB,WAAxB,EAAhB;;AAEA,QAAK,cAAc,KAAnB,EAA2B;;AAE1B,SAAI,SAAS,IAAI,aAAJ,CAAmB,OAAnB,CAAb;AACA,YAAO,OAAO,KAAP,CAAc,IAAI,KAAJ,CAAW,IAAX,EAAkB,MAAlB,EAAd,CAAP;AAEA;AAED;AAED;;AAED,UAAQ,KAAR,CAAe,sCAAf;AACA,SAAO,EAAE,OAAO,IAAI,KAAJ,EAAT,EAAP;AAEA;;AA5FsE,CAAlD,CAAtB;;AAgGA,SAAS,SAAT","file":"KMZLoader-compiled.js","sourcesContent":["/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nimport {\n\tFileLoader,\n\tGroup,\n\tLoader,\n\tLoadingManager\n} from \"../../../build/three.module.js\";\nimport { ColladaLoader } from \"../loaders/ColladaLoader.js\";\n\nvar KMZLoader = function ( manager ) {\n\n\tLoader.call( this, manager );\n\n};\n\nKMZLoader.prototype = Object.assign( Object.create( Loader.prototype ), {\n\n\tconstructor: KMZLoader,\n\n\tload: function ( url, onLoad, onProgress, onError ) {\n\n\t\tvar scope = this;\n\n\t\tvar loader = new FileLoader( scope.manager );\n\t\tloader.setPath( scope.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.load( url, function ( text ) {\n\n\t\t\tonLoad( scope.parse( text ) );\n\n\t\t}, onProgress, onError );\n\n\t},\n\n\tparse: function ( data ) {\n\n\t\tfunction findFile( url ) {\n\n\t\t\tfor ( var path in zip.files ) {\n\n\t\t\t\tif ( path.substr( - url.length ) === url ) {\n\n\t\t\t\t\treturn zip.files[ path ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tvar manager = new LoadingManager();\n\t\tmanager.setURLModifier( function ( url ) {\n\n\t\t\tvar image = findFile( url );\n\n\t\t\tif ( image ) {\n\n\t\t\t\tconsole.log( 'Loading', url );\n\n\t\t\t\tvar blob = new Blob( [ image.asArrayBuffer() ], { type: 'application/octet-stream' } );\n\t\t\t\treturn URL.createObjectURL( blob );\n\n\t\t\t}\n\n\t\t\treturn url;\n\n\t\t} );\n\n\t\t//\n\n\t\tvar zip = new JSZip( data ); // eslint-disable-line no-undef\n\n\t\tif ( zip.files[ 'doc.kml' ] ) {\n\n\t\t\tvar xml = new DOMParser().parseFromString( zip.files[ 'doc.kml' ].asText(), 'application/xml' );\n\n\t\t\tvar model = xml.querySelector( 'Placemark Model Link href' );\n\n\t\t\tif ( model ) {\n\n\t\t\t\tvar loader = new ColladaLoader( manager );\n\t\t\t\treturn loader.parse( zip.files[ model.textContent ].asText() );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'KMZLoader: Missing doc.kml file.' );\n\n\t\t\tfor ( var path in zip.files ) {\n\n\t\t\t\tvar extension = path.split( '.' ).pop().toLowerCase();\n\n\t\t\t\tif ( extension === 'dae' ) {\n\n\t\t\t\t\tvar loader = new ColladaLoader( manager );\n\t\t\t\t\treturn loader.parse( zip.files[ path ].asText() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tconsole.error( 'KMZLoader: Couldn\\'t find .dae file.' );\n\t\treturn { scene: new Group() };\n\n\t}\n\n} );\n\nexport { KMZLoader };\n"]}