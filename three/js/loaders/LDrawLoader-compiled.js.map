{"version":3,"sources":["LDrawLoader.js"],"names":[],"mappings":"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","file":"LDrawLoader-compiled.js","sourcesContent":["console.warn( \"THREE.LDrawLoader: As part of the transition to ES6 Modules, the files in 'examples/js' were deprecated in May 2020 (r117) and will be deleted in December 2020 (r124). You can find more information about developing using ES6 Modules in https://threejs.org/docs/#manual/en/introduction/Installation.\" );\n\nTHREE.LDrawLoader = ( function () {\n\n\tvar conditionalLineVertShader = /* glsl */`\n\tattribute vec3 control0;\n\tattribute vec3 control1;\n\tattribute vec3 direction;\n\tvarying float discardFlag;\n\n\t#include <common>\n\t#include <color_pars_vertex>\n\t#include <fog_pars_vertex>\n\t#include <logdepthbuf_pars_vertex>\n\t#include <clipping_planes_pars_vertex>\n\tvoid main() {\n\t\t#include <color_vertex>\n\n\t\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\t\tgl_Position = projectionMatrix * mvPosition;\n\n\t\t// Transform the line segment ends and control points into camera clip space\n\t\tvec4 c0 = projectionMatrix * modelViewMatrix * vec4( control0, 1.0 );\n\t\tvec4 c1 = projectionMatrix * modelViewMatrix * vec4( control1, 1.0 );\n\t\tvec4 p0 = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\tvec4 p1 = projectionMatrix * modelViewMatrix * vec4( position + direction, 1.0 );\n\n\t\tc0.xy /= c0.w;\n\t\tc1.xy /= c1.w;\n\t\tp0.xy /= p0.w;\n\t\tp1.xy /= p1.w;\n\n\t\t// Get the direction of the segment and an orthogonal vector\n\t\tvec2 dir = p1.xy - p0.xy;\n\t\tvec2 norm = vec2( -dir.y, dir.x );\n\n\t\t// Get control point directions from the line\n\t\tvec2 c0dir = c0.xy - p1.xy;\n\t\tvec2 c1dir = c1.xy - p1.xy;\n\n\t\t// If the vectors to the controls points are pointed in different directions away\n\t\t// from the line segment then the line should not be drawn.\n\t\tfloat d0 = dot( normalize( norm ), normalize( c0dir ) );\n\t\tfloat d1 = dot( normalize( norm ), normalize( c1dir ) );\n\t\tdiscardFlag = float( sign( d0 ) != sign( d1 ) );\n\n\t\t#include <logdepthbuf_vertex>\n\t\t#include <clipping_planes_vertex>\n\t\t#include <fog_vertex>\n\t}\n\t`;\n\n\tvar conditionalLineFragShader = /* glsl */`\n\tuniform vec3 diffuse;\n\tuniform float opacity;\n\tvarying float discardFlag;\n\n\t#include <common>\n\t#include <color_pars_fragment>\n\t#include <fog_pars_fragment>\n\t#include <logdepthbuf_pars_fragment>\n\t#include <clipping_planes_pars_fragment>\n\tvoid main() {\n\n\t\tif ( discardFlag > 0.5 ) discard;\n\n\t\t#include <clipping_planes_fragment>\n\t\tvec3 outgoingLight = vec3( 0.0 );\n\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t\t#include <logdepthbuf_fragment>\n\t\t#include <color_fragment>\n\t\toutgoingLight = diffuseColor.rgb; // simple shader\n\t\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t\t#include <tonemapping_fragment>\n\t\t#include <encodings_fragment>\n\t\t#include <fog_fragment>\n\t\t#include <premultiplied_alpha_fragment>\n\t}\n\t`;\n\n\n\n\tvar tempVec0 = new THREE.Vector3();\n\tvar tempVec1 = new THREE.Vector3();\n\tfunction smoothNormals( triangles, lineSegments ) {\n\n\t\tfunction hashVertex( v ) {\n\n\t\t\t// NOTE: 1e2 is pretty coarse but was chosen because it allows edges\n\t\t\t// to be smoothed as expected (see minifig arms). The errors between edges\n\t\t\t// could be due to matrix multiplication.\n\t\t\tvar x = ~ ~ ( v.x * 1e2 );\n\t\t\tvar y = ~ ~ ( v.y * 1e2 );\n\t\t\tvar z = ~ ~ ( v.z * 1e2 );\n\t\t\treturn `${ x },${ y },${ z }`;\n\n\t\t}\n\n\t\tfunction hashEdge( v0, v1 ) {\n\n\t\t\treturn `${ hashVertex( v0 ) }_${ hashVertex( v1 ) }`;\n\n\t\t}\n\n\t\tvar hardEdges = new Set();\n\t\tvar halfEdgeList = {};\n\t\tvar fullHalfEdgeList = {};\n\t\tvar normals = [];\n\n\t\t// Save the list of hard edges by hash\n\t\tfor ( var i = 0, l = lineSegments.length; i < l; i ++ ) {\n\n\t\t\tvar ls = lineSegments[ i ];\n\t\t\tvar v0 = ls.v0;\n\t\t\tvar v1 = ls.v1;\n\t\t\thardEdges.add( hashEdge( v0, v1 ) );\n\t\t\thardEdges.add( hashEdge( v1, v0 ) );\n\n\t\t}\n\n\t\t// track the half edges associated with each triangle\n\t\tfor ( var i = 0, l = triangles.length; i < l; i ++ ) {\n\n\t\t\tvar tri = triangles[ i ];\n\t\t\tfor ( var i2 = 0, l2 = 3; i2 < l2; i2 ++ ) {\n\n\t\t\t\tvar index = i2;\n\t\t\t\tvar next = ( i2 + 1 ) % 3;\n\t\t\t\tvar v0 = tri[ `v${ index }` ];\n\t\t\t\tvar v1 = tri[ `v${ next }` ];\n\t\t\t\tvar hash = hashEdge( v0, v1 );\n\n\t\t\t\t// don't add the triangle if the edge is supposed to be hard\n\t\t\t\tif ( hardEdges.has( hash ) ) continue;\n\t\t\t\thalfEdgeList[ hash ] = tri;\n\t\t\t\tfullHalfEdgeList[ hash ] = tri;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// NOTE: Some of the normals wind up being skewed in an unexpected way because\n\t\t// quads provide more \"influence\" to some vertex normals than a triangle due to\n\t\t// the fact that a quad is made up of two triangles and all triangles are weighted\n\t\t// equally. To fix this quads could be tracked separately so their vertex normals\n\t\t// are weighted appropriately or we could try only adding a normal direction\n\t\t// once per normal.\n\n\t\t// Iterate until we've tried to connect all triangles to share normals\n\t\twhile ( true ) {\n\n\t\t\t// Stop if there are no more triangles left\n\t\t\tvar halfEdges = Object.keys( halfEdgeList );\n\t\t\tif ( halfEdges.length === 0 ) break;\n\n\t\t\t// Exhaustively find all connected triangles\n\t\t\tvar i = 0;\n\t\t\tvar queue = [ fullHalfEdgeList[ halfEdges[ 0 ] ] ];\n\t\t\twhile ( i < queue.length ) {\n\n\t\t\t\t// initialize all vertex normals in this triangle\n\t\t\t\tvar tri = queue[ i ];\n\t\t\t\ti ++;\n\n\t\t\t\tvar faceNormal = tri.faceNormal;\n\t\t\t\tif ( tri.n0 === null ) {\n\n\t\t\t\t\ttri.n0 = faceNormal.clone();\n\t\t\t\t\tnormals.push( tri.n0 );\n\n\t\t\t\t}\n\n\t\t\t\tif ( tri.n1 === null ) {\n\n\t\t\t\t\ttri.n1 = faceNormal.clone();\n\t\t\t\t\tnormals.push( tri.n1 );\n\n\t\t\t\t}\n\n\t\t\t\tif ( tri.n2 === null ) {\n\n\t\t\t\t\ttri.n2 = faceNormal.clone();\n\t\t\t\t\tnormals.push( tri.n2 );\n\n\t\t\t\t}\n\n\t\t\t\t// Check if any edge is connected to another triangle edge\n\t\t\t\tfor ( var i2 = 0, l2 = 3; i2 < l2; i2 ++ ) {\n\n\t\t\t\t\tvar index = i2;\n\t\t\t\t\tvar next = ( i2 + 1 ) % 3;\n\t\t\t\t\tvar v0 = tri[ `v${ index }` ];\n\t\t\t\t\tvar v1 = tri[ `v${ next }` ];\n\n\t\t\t\t\t// delete this triangle from the list so it won't be found again\n\t\t\t\t\tvar hash = hashEdge( v0, v1 );\n\t\t\t\t\tdelete halfEdgeList[ hash ];\n\n\t\t\t\t\tvar reverseHash = hashEdge( v1, v0 );\n\t\t\t\t\tvar otherTri = fullHalfEdgeList[ reverseHash ];\n\t\t\t\t\tif ( otherTri ) {\n\n\t\t\t\t\t\t// NOTE: If the angle between triangles is > 67.5 degrees then assume it's\n\t\t\t\t\t\t// hard edge. There are some cases where the line segments do not line up exactly\n\t\t\t\t\t\t// with or span multiple triangle edges (see Lunar Vehicle wheels).\n\t\t\t\t\t\tif ( Math.abs( otherTri.faceNormal.dot( tri.faceNormal ) ) < 0.25 ) {\n\n\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// if this triangle has already been traversed then it won't be in\n\t\t\t\t\t\t// the halfEdgeList. If it has not then add it to the queue and delete\n\t\t\t\t\t\t// it so it won't be found again.\n\t\t\t\t\t\tif ( reverseHash in halfEdgeList ) {\n\n\t\t\t\t\t\t\tqueue.push( otherTri );\n\t\t\t\t\t\t\tdelete halfEdgeList[ reverseHash ];\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Find the matching edge in this triangle and copy the normal vector over\n\t\t\t\t\t\tfor ( var i3 = 0, l3 = 3; i3 < l3; i3 ++ ) {\n\n\t\t\t\t\t\t\tvar otherIndex = i3;\n\t\t\t\t\t\t\tvar otherNext = ( i3 + 1 ) % 3;\n\t\t\t\t\t\t\tvar otherV0 = otherTri[ `v${ otherIndex }` ];\n\t\t\t\t\t\t\tvar otherV1 = otherTri[ `v${ otherNext }` ];\n\n\t\t\t\t\t\t\tvar otherHash = hashEdge( otherV0, otherV1 );\n\t\t\t\t\t\t\tif ( otherHash === reverseHash ) {\n\n\t\t\t\t\t\t\t\tif ( otherTri[ `n${ otherIndex }` ] === null ) {\n\n\t\t\t\t\t\t\t\t\tvar norm = tri[ `n${ next }` ];\n\t\t\t\t\t\t\t\t\totherTri[ `n${ otherIndex }` ] = norm;\n\t\t\t\t\t\t\t\t\tnorm.add( otherTri.faceNormal );\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif ( otherTri[ `n${ otherNext }` ] === null ) {\n\n\t\t\t\t\t\t\t\t\tvar norm = tri[ `n${ index }` ];\n\t\t\t\t\t\t\t\t\totherTri[ `n${ otherNext }` ] = norm;\n\t\t\t\t\t\t\t\t\tnorm.add( otherTri.faceNormal );\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// The normals of each face have been added up so now we average them by normalizing the vector.\n\t\tfor ( var i = 0, l = normals.length; i < l; i ++ ) {\n\n\t\t\tnormals[ i ].normalize();\n\n\t\t}\n\n\t}\n\n\tfunction isPrimitiveType( type ) {\n\n\t\treturn /primitive/i.test( type ) || type === 'Subpart';\n\n\t}\n\n\tfunction LineParser( line, lineNumber ) {\n\n\t\tthis.line = line;\n\t\tthis.lineLength = line.length;\n\t\tthis.currentCharIndex = 0;\n\t\tthis.currentChar = ' ';\n\t\tthis.lineNumber = lineNumber;\n\n\t}\n\n\tLineParser.prototype = {\n\n\t\tconstructor: LineParser,\n\n\t\tseekNonSpace: function () {\n\n\t\t\twhile ( this.currentCharIndex < this.lineLength ) {\n\n\t\t\t\tthis.currentChar = this.line.charAt( this.currentCharIndex );\n\n\t\t\t\tif ( this.currentChar !== ' ' && this.currentChar !== '\\t' ) {\n\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t\tthis.currentCharIndex ++;\n\n\t\t\t}\n\n\t\t},\n\n\t\tgetToken: function () {\n\n\t\t\tvar pos0 = this.currentCharIndex ++;\n\n\t\t\t// Seek space\n\t\t\twhile ( this.currentCharIndex < this.lineLength ) {\n\n\t\t\t\tthis.currentChar = this.line.charAt( this.currentCharIndex );\n\n\t\t\t\tif ( this.currentChar === ' ' || this.currentChar === '\\t' ) {\n\n\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tthis.currentCharIndex ++;\n\n\t\t\t}\n\n\t\t\tvar pos1 = this.currentCharIndex;\n\n\t\t\tthis.seekNonSpace();\n\n\t\t\treturn this.line.substring( pos0, pos1 );\n\n\t\t},\n\n\t\tgetRemainingString: function () {\n\n\t\t\treturn this.line.substring( this.currentCharIndex, this.lineLength );\n\n\t\t},\n\n\t\tisAtTheEnd: function () {\n\n\t\t\treturn this.currentCharIndex >= this.lineLength;\n\n\t\t},\n\n\t\tsetToEnd: function () {\n\n\t\t\tthis.currentCharIndex = this.lineLength;\n\n\t\t},\n\n\t\tgetLineNumberString: function () {\n\n\t\t\treturn this.lineNumber >= 0 ? \" at line \" + this.lineNumber : \"\";\n\n\t\t}\n\n\n\t};\n\n\tfunction sortByMaterial( a, b ) {\n\n\t\tif ( a.colourCode === b.colourCode ) {\n\n\t\t\treturn 0;\n\n\t\t}\n\n\t\tif ( a.colourCode < b.colourCode ) {\n\n\t\t\treturn - 1;\n\n\t\t}\n\n\t\treturn 1;\n\n\t}\n\n\tfunction createObject( elements, elementSize, isConditionalSegments ) {\n\n\t\t// Creates a THREE.LineSegments (elementSize = 2) or a THREE.Mesh (elementSize = 3 )\n\t\t// With per face / segment material, implemented with mesh groups and materials array\n\n\t\t// Sort the triangles or line segments by colour code to make later the mesh groups\n\t\telements.sort( sortByMaterial );\n\n\t\tvar positions = [];\n\t\tvar normals = [];\n\t\tvar materials = [];\n\n\t\tvar bufferGeometry = new THREE.BufferGeometry();\n\t\tvar prevMaterial = null;\n\t\tvar index0 = 0;\n\t\tvar numGroupVerts = 0;\n\n\t\tfor ( var iElem = 0, nElem = elements.length; iElem < nElem; iElem ++ ) {\n\n\t\t\tvar elem = elements[ iElem ];\n\t\t\tvar v0 = elem.v0;\n\t\t\tvar v1 = elem.v1;\n\t\t\t// Note that LDraw coordinate system is rotated 180 deg. in the X axis w.r.t. Three.js's one\n\t\t\tpositions.push( v0.x, v0.y, v0.z, v1.x, v1.y, v1.z );\n\t\t\tif ( elementSize === 3 ) {\n\n\t\t\t\tpositions.push( elem.v2.x, elem.v2.y, elem.v2.z );\n\n\t\t\t\tvar n0 = elem.n0 || elem.faceNormal;\n\t\t\t\tvar n1 = elem.n1 || elem.faceNormal;\n\t\t\t\tvar n2 = elem.n2 || elem.faceNormal;\n\t\t\t\tnormals.push( n0.x, n0.y, n0.z );\n\t\t\t\tnormals.push( n1.x, n1.y, n1.z );\n\t\t\t\tnormals.push( n2.x, n2.y, n2.z );\n\n\t\t\t}\n\n\t\t\tif ( prevMaterial !== elem.material ) {\n\n\t\t\t\tif ( prevMaterial !== null ) {\n\n\t\t\t\t\tbufferGeometry.addGroup( index0, numGroupVerts, materials.length - 1 );\n\n\t\t\t\t}\n\n\t\t\t\tmaterials.push( elem.material );\n\n\t\t\t\tprevMaterial = elem.material;\n\t\t\t\tindex0 = iElem * elementSize;\n\t\t\t\tnumGroupVerts = elementSize;\n\n\t\t\t} else {\n\n\t\t\t\tnumGroupVerts += elementSize;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( numGroupVerts > 0 ) {\n\n\t\t\tbufferGeometry.addGroup( index0, Infinity, materials.length - 1 );\n\n\t\t}\n\n\t\tbufferGeometry.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );\n\n\t\tif ( elementSize === 3 ) {\n\n\t\t\tbufferGeometry.setAttribute( 'normal', new THREE.Float32BufferAttribute( normals, 3 ) );\n\n\t\t}\n\n\t\tvar object3d = null;\n\n\t\tif ( elementSize === 2 ) {\n\n\t\t\tobject3d = new THREE.LineSegments( bufferGeometry, materials );\n\n\t\t} else if ( elementSize === 3 ) {\n\n\t\t\tobject3d = new THREE.Mesh( bufferGeometry, materials );\n\n\t\t}\n\n\t\tif ( isConditionalSegments ) {\n\n\t\t\tobject3d.isConditionalLine = true;\n\n\t\t\tvar controlArray0 = new Float32Array( elements.length * 3 * 2 );\n\t\t\tvar controlArray1 = new Float32Array( elements.length * 3 * 2 );\n\t\t\tvar directionArray = new Float32Array( elements.length * 3 * 2 );\n\t\t\tfor ( var i = 0, l = elements.length; i < l; i ++ ) {\n\n\t\t\t\tvar os = elements[ i ];\n\t\t\t\tvar c0 = os.c0;\n\t\t\t\tvar c1 = os.c1;\n\t\t\t\tvar v0 = os.v0;\n\t\t\t\tvar v1 = os.v1;\n\t\t\t\tvar index = i * 3 * 2;\n\t\t\t\tcontrolArray0[ index + 0 ] = c0.x;\n\t\t\t\tcontrolArray0[ index + 1 ] = c0.y;\n\t\t\t\tcontrolArray0[ index + 2 ] = c0.z;\n\t\t\t\tcontrolArray0[ index + 3 ] = c0.x;\n\t\t\t\tcontrolArray0[ index + 4 ] = c0.y;\n\t\t\t\tcontrolArray0[ index + 5 ] = c0.z;\n\n\t\t\t\tcontrolArray1[ index + 0 ] = c1.x;\n\t\t\t\tcontrolArray1[ index + 1 ] = c1.y;\n\t\t\t\tcontrolArray1[ index + 2 ] = c1.z;\n\t\t\t\tcontrolArray1[ index + 3 ] = c1.x;\n\t\t\t\tcontrolArray1[ index + 4 ] = c1.y;\n\t\t\t\tcontrolArray1[ index + 5 ] = c1.z;\n\n\t\t\t\tdirectionArray[ index + 0 ] = v1.x - v0.x;\n\t\t\t\tdirectionArray[ index + 1 ] = v1.y - v0.y;\n\t\t\t\tdirectionArray[ index + 2 ] = v1.z - v0.z;\n\t\t\t\tdirectionArray[ index + 3 ] = v1.x - v0.x;\n\t\t\t\tdirectionArray[ index + 4 ] = v1.y - v0.y;\n\t\t\t\tdirectionArray[ index + 5 ] = v1.z - v0.z;\n\n\t\t\t}\n\n\t\t\tbufferGeometry.setAttribute( 'control0', new THREE.BufferAttribute( controlArray0, 3, false ) );\n\t\t\tbufferGeometry.setAttribute( 'control1', new THREE.BufferAttribute( controlArray1, 3, false ) );\n\t\t\tbufferGeometry.setAttribute( 'direction', new THREE.BufferAttribute( directionArray, 3, false ) );\n\n\t\t}\n\n\t\treturn object3d;\n\n\t}\n\n\t//\n\n\tfunction LDrawLoader( manager ) {\n\n\t\tTHREE.Loader.call( this, manager );\n\n\t\t// This is a stack of 'parse scopes' with one level per subobject loaded file.\n\t\t// Each level contains a material lib and also other runtime variables passed between parent and child subobjects\n\t\t// When searching for a material code, the stack is read from top of the stack to bottom\n\t\t// Each material library is an object map keyed by colour codes.\n\t\tthis.parseScopesStack = null;\n\n\t\t// Array of THREE.Material\n\t\tthis.materials = [];\n\n\t\t// Not using THREE.Cache here because it returns the previous HTML error response instead of calling onError()\n\t\t// This also allows to handle the embedded text files (\"0 FILE\" lines)\n\t\tthis.subobjectCache = {};\n\n\t\t// This object is a map from file names to paths. It agilizes the paths search. If it is not set then files will be searched by trial and error.\n\t\tthis.fileMap = null;\n\n\t\t// Add default main triangle and line edge materials (used in piecess that can be coloured with a main color)\n\t\tthis.setMaterials( [\n\t\t\tthis.parseColourMetaDirective( new LineParser( \"Main_Colour CODE 16 VALUE #FF8080 EDGE #333333\" ) ),\n\t\t\tthis.parseColourMetaDirective( new LineParser( \"Edge_Colour CODE 24 VALUE #A0A0A0 EDGE #333333\" ) )\n\t\t] );\n\n\t\t// If this flag is set to true, each subobject will be a THREE.Object.\n\t\t// If not (the default), only one object which contains all the merged primitives will be created.\n\t\tthis.separateObjects = false;\n\n\t\t// If this flag is set to true the vertex normals will be smoothed.\n\t\tthis.smoothNormals = true;\n\n\t}\n\n\t// Special surface finish tag types.\n\t// Note: \"MATERIAL\" tag (e.g. GLITTER, SPECKLE) is not implemented\n\tLDrawLoader.FINISH_TYPE_DEFAULT = 0;\n\tLDrawLoader.FINISH_TYPE_CHROME = 1;\n\tLDrawLoader.FINISH_TYPE_PEARLESCENT = 2;\n\tLDrawLoader.FINISH_TYPE_RUBBER = 3;\n\tLDrawLoader.FINISH_TYPE_MATTE_METALLIC = 4;\n\tLDrawLoader.FINISH_TYPE_METAL = 5;\n\n\t// State machine to search a subobject path.\n\t// The LDraw standard establishes these various possible subfolders.\n\tLDrawLoader.FILE_LOCATION_AS_IS = 0;\n\tLDrawLoader.FILE_LOCATION_TRY_PARTS = 1;\n\tLDrawLoader.FILE_LOCATION_TRY_P = 2;\n\tLDrawLoader.FILE_LOCATION_TRY_MODELS = 3;\n\tLDrawLoader.FILE_LOCATION_TRY_RELATIVE = 4;\n\tLDrawLoader.FILE_LOCATION_TRY_ABSOLUTE = 5;\n\tLDrawLoader.FILE_LOCATION_NOT_FOUND = 6;\n\n\tLDrawLoader.prototype = Object.assign( Object.create( THREE.Loader.prototype ), {\n\n\t\tconstructor: LDrawLoader,\n\n\t\tload: function ( url, onLoad, onProgress, onError ) {\n\n\t\t\tif ( ! this.fileMap ) {\n\n\t\t\t\tthis.fileMap = {};\n\n\t\t\t}\n\n\t\t\tvar scope = this;\n\n\t\t\tvar fileLoader = new THREE.FileLoader( this.manager );\n\t\t\tfileLoader.setPath( this.path );\n\t\t\tfileLoader.setRequestHeader( this.requestHeader );\n\t\t\tfileLoader.setWithCredentials( this.withCredentials );\n\t\t\tfileLoader.load( url, function ( text ) {\n\n\t\t\t\tscope.processObject( text, onLoad, null, url );\n\n\t\t\t}, onProgress, onError );\n\n\t\t},\n\n\t\tparse: function ( text, path, onLoad ) {\n\n\t\t\t// Async parse.  This function calls onParse with the parsed THREE.Object3D as parameter\n\n\t\t\tthis.processObject( text, onLoad, null, path );\n\n\t\t},\n\n\t\tsetMaterials: function ( materials ) {\n\n\t\t\t// Clears parse scopes stack, adds new scope with material library\n\n\t\t\tthis.parseScopesStack = [];\n\n\t\t\tthis.newParseScopeLevel( materials );\n\n\t\t\tthis.getCurrentParseScope().isFromParse = false;\n\n\t\t\tthis.materials = materials;\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\tsetFileMap: function ( fileMap ) {\n\n\t\t\tthis.fileMap = fileMap;\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\tnewParseScopeLevel: function ( materials ) {\n\n\t\t\t// Adds a new scope level, assign materials to it and returns it\n\n\t\t\tvar matLib = {};\n\n\t\t\tif ( materials ) {\n\n\t\t\t\tfor ( var i = 0, n = materials.length; i < n; i ++ ) {\n\n\t\t\t\t\tvar material = materials[ i ];\n\t\t\t\t\tmatLib[ material.userData.code ] = material;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tvar topParseScope = this.getCurrentParseScope();\n\t\t\tvar newParseScope = {\n\n\t\t\t\tlib: matLib,\n\t\t\t\turl: null,\n\n\t\t\t\t// Subobjects\n\t\t\t\tsubobjects: null,\n\t\t\t\tnumSubobjects: 0,\n\t\t\t\tsubobjectIndex: 0,\n\t\t\t\tinverted: false,\n\t\t\t\tcategory: null,\n\t\t\t\tkeywords: null,\n\n\t\t\t\t// Current subobject\n\t\t\t\tcurrentFileName: null,\n\t\t\t\tmainColourCode: topParseScope ? topParseScope.mainColourCode : '16',\n\t\t\t\tmainEdgeColourCode: topParseScope ? topParseScope.mainEdgeColourCode : '24',\n\t\t\t\tcurrentMatrix: new THREE.Matrix4(),\n\t\t\t\tmatrix: new THREE.Matrix4(),\n\n\t\t\t\t// If false, it is a root material scope previous to parse\n\t\t\t\tisFromParse: true,\n\n\t\t\t\ttriangles: null,\n\t\t\t\tlineSegments: null,\n\t\t\t\tconditionalSegments: null,\n\n\t\t\t\t// If true, this object is the start of a construction step\n\t\t\t\tstartingConstructionStep: false\n\t\t\t};\n\n\t\t\tthis.parseScopesStack.push( newParseScope );\n\n\t\t\treturn newParseScope;\n\n\t\t},\n\n\t\tremoveScopeLevel: function () {\n\n\t\t\tthis.parseScopesStack.pop();\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\taddMaterial: function ( material ) {\n\n\t\t\t// Adds a material to the material library which is on top of the parse scopes stack. And also to the materials array\n\n\t\t\tvar matLib = this.getCurrentParseScope().lib;\n\n\t\t\tif ( ! matLib[ material.userData.code ] ) {\n\n\t\t\t\tthis.materials.push( material );\n\n\t\t\t}\n\n\t\t\tmatLib[ material.userData.code ] = material;\n\n\t\t\treturn this;\n\n\t\t},\n\n\t\tgetMaterial: function ( colourCode ) {\n\n\t\t\t// Given a colour code search its material in the parse scopes stack\n\n\t\t\tif ( colourCode.startsWith( \"0x2\" ) ) {\n\n\t\t\t\t// Special 'direct' material value (RGB colour)\n\n\t\t\t\tvar colour = colourCode.substring( 3 );\n\n\t\t\t\treturn this.parseColourMetaDirective( new LineParser( \"Direct_Color_\" + colour + \" CODE -1 VALUE #\" + colour + \" EDGE #\" + colour + \"\" ) );\n\n\t\t\t}\n\n\t\t\tfor ( var i = this.parseScopesStack.length - 1; i >= 0; i -- ) {\n\n\t\t\t\tvar material = this.parseScopesStack[ i ].lib[ colourCode ];\n\n\t\t\t\tif ( material ) {\n\n\t\t\t\t\treturn material;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// Material was not found\n\t\t\treturn null;\n\n\t\t},\n\n\t\tgetParentParseScope: function () {\n\n\t\t\tif ( this.parseScopesStack.length > 1 ) {\n\n\t\t\t\treturn this.parseScopesStack[ this.parseScopesStack.length - 2 ];\n\n\t\t\t}\n\n\t\t\treturn null;\n\n\t\t},\n\n\t\tgetCurrentParseScope: function () {\n\n\t\t\tif ( this.parseScopesStack.length > 0 ) {\n\n\t\t\t\treturn this.parseScopesStack[ this.parseScopesStack.length - 1 ];\n\n\t\t\t}\n\n\t\t\treturn null;\n\n\t\t},\n\n\t\tparseColourMetaDirective: function ( lineParser ) {\n\n\t\t\t// Parses a colour definition and returns a THREE.Material or null if error\n\n\t\t\tvar code = null;\n\n\t\t\t// Triangle and line colours\n\t\t\tvar colour = 0xFF00FF;\n\t\t\tvar edgeColour = 0xFF00FF;\n\n\t\t\t// Transparency\n\t\t\tvar alpha = 1;\n\t\t\tvar isTransparent = false;\n\t\t\t// Self-illumination:\n\t\t\tvar luminance = 0;\n\n\t\t\tvar finishType = LDrawLoader.FINISH_TYPE_DEFAULT;\n\t\t\tvar canHaveEnvMap = true;\n\n\t\t\tvar edgeMaterial = null;\n\n\t\t\tvar name = lineParser.getToken();\n\t\t\tif ( ! name ) {\n\n\t\t\t\tthrow 'LDrawLoader: Material name was expected after \"!COLOUR tag' + lineParser.getLineNumberString() + \".\";\n\n\t\t\t}\n\n\t\t\t// Parse tag tokens and their parameters\n\t\t\tvar token = null;\n\t\t\twhile ( true ) {\n\n\t\t\t\ttoken = lineParser.getToken();\n\n\t\t\t\tif ( ! token ) {\n\n\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tswitch ( token.toUpperCase() ) {\n\n\t\t\t\t\tcase \"CODE\":\n\n\t\t\t\t\t\tcode = lineParser.getToken();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase \"VALUE\":\n\n\t\t\t\t\t\tcolour = lineParser.getToken();\n\t\t\t\t\t\tif ( colour.startsWith( '0x' ) ) {\n\n\t\t\t\t\t\t\tcolour = '#' + colour.substring( 2 );\n\n\t\t\t\t\t\t} else if ( ! colour.startsWith( '#' ) ) {\n\n\t\t\t\t\t\t\tthrow 'LDrawLoader: Invalid colour while parsing material' + lineParser.getLineNumberString() + \".\";\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase \"EDGE\":\n\n\t\t\t\t\t\tedgeColour = lineParser.getToken();\n\t\t\t\t\t\tif ( edgeColour.startsWith( '0x' ) ) {\n\n\t\t\t\t\t\t\tedgeColour = '#' + edgeColour.substring( 2 );\n\n\t\t\t\t\t\t} else if ( ! edgeColour.startsWith( '#' ) ) {\n\n\t\t\t\t\t\t\t// Try to see if edge colour is a colour code\n\t\t\t\t\t\t\tedgeMaterial = this.getMaterial( edgeColour );\n\t\t\t\t\t\t\tif ( ! edgeMaterial ) {\n\n\t\t\t\t\t\t\t\tthrow 'LDrawLoader: Invalid edge colour while parsing material' + lineParser.getLineNumberString() + \".\";\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Get the edge material for this triangle material\n\t\t\t\t\t\t\tedgeMaterial = edgeMaterial.userData.edgeMaterial;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'ALPHA':\n\n\t\t\t\t\t\talpha = parseInt( lineParser.getToken() );\n\n\t\t\t\t\t\tif ( isNaN( alpha ) ) {\n\n\t\t\t\t\t\t\tthrow 'LDrawLoader: Invalid alpha value in material definition' + lineParser.getLineNumberString() + \".\";\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\talpha = Math.max( 0, Math.min( 1, alpha / 255 ) );\n\n\t\t\t\t\t\tif ( alpha < 1 ) {\n\n\t\t\t\t\t\t\tisTransparent = true;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'LUMINANCE':\n\n\t\t\t\t\t\tluminance = parseInt( lineParser.getToken() );\n\n\t\t\t\t\t\tif ( isNaN( luminance ) ) {\n\n\t\t\t\t\t\t\tthrow 'LDrawLoader: Invalid luminance value in material definition' + LineParser.getLineNumberString() + \".\";\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tluminance = Math.max( 0, Math.min( 1, luminance / 255 ) );\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'CHROME':\n\t\t\t\t\t\tfinishType = LDrawLoader.FINISH_TYPE_CHROME;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'PEARLESCENT':\n\t\t\t\t\t\tfinishType = LDrawLoader.FINISH_TYPE_PEARLESCENT;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'RUBBER':\n\t\t\t\t\t\tfinishType = LDrawLoader.FINISH_TYPE_RUBBER;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'MATTE_METALLIC':\n\t\t\t\t\t\tfinishType = LDrawLoader.FINISH_TYPE_MATTE_METALLIC;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'METAL':\n\t\t\t\t\t\tfinishType = LDrawLoader.FINISH_TYPE_METAL;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'MATERIAL':\n\t\t\t\t\t\t// Not implemented\n\t\t\t\t\t\tlineParser.setToEnd();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow 'LDrawLoader: Unknown token \"' + token + '\" while parsing material' + lineParser.getLineNumberString() + \".\";\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tvar material = null;\n\n\t\t\tswitch ( finishType ) {\n\n\t\t\t\tcase LDrawLoader.FINISH_TYPE_DEFAULT:\n\n\t\t\t\t\tmaterial = new THREE.MeshStandardMaterial( { color: colour, roughness: 0.3, envMapIntensity: 0.3, metalness: 0 } );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase LDrawLoader.FINISH_TYPE_PEARLESCENT:\n\n\t\t\t\t\t// Try to imitate pearlescency by setting the specular to the complementary of the color, and low shininess\n\t\t\t\t\tvar specular = new THREE.Color( colour );\n\t\t\t\t\tvar hsl = specular.getHSL( { h: 0, s: 0, l: 0 } );\n\t\t\t\t\thsl.h = ( hsl.h + 0.5 ) % 1;\n\t\t\t\t\thsl.l = Math.min( 1, hsl.l + ( 1 - hsl.l ) * 0.7 );\n\t\t\t\t\tspecular.setHSL( hsl.h, hsl.s, hsl.l );\n\n\t\t\t\t\tmaterial = new THREE.MeshPhongMaterial( { color: colour, specular: specular, shininess: 10, reflectivity: 0.3 } );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase LDrawLoader.FINISH_TYPE_CHROME:\n\n\t\t\t\t\t// Mirror finish surface\n\t\t\t\t\tmaterial = new THREE.MeshStandardMaterial( { color: colour, roughness: 0, metalness: 1 } );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase LDrawLoader.FINISH_TYPE_RUBBER:\n\n\t\t\t\t\t// Rubber finish\n\t\t\t\t\tmaterial = new THREE.MeshStandardMaterial( { color: colour, roughness: 0.9, metalness: 0 } );\n\t\t\t\t\tcanHaveEnvMap = false;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase LDrawLoader.FINISH_TYPE_MATTE_METALLIC:\n\n\t\t\t\t\t// Brushed metal finish\n\t\t\t\t\tmaterial = new THREE.MeshStandardMaterial( { color: colour, roughness: 0.8, metalness: 0.4 } );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase LDrawLoader.FINISH_TYPE_METAL:\n\n\t\t\t\t\t// Average metal finish\n\t\t\t\t\tmaterial = new THREE.MeshStandardMaterial( { color: colour, roughness: 0.2, metalness: 0.85 } );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\t// Should not happen\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tmaterial.transparent = isTransparent;\n\t\t\tmaterial.premultipliedAlpha = true;\n\t\t\tmaterial.opacity = alpha;\n\t\t\tmaterial.depthWrite = ! isTransparent;\n\n\t\t\tmaterial.polygonOffset = true;\n\t\t\tmaterial.polygonOffsetFactor = 1;\n\n\t\t\tmaterial.userData.canHaveEnvMap = canHaveEnvMap;\n\n\t\t\tif ( luminance !== 0 ) {\n\n\t\t\t\tmaterial.emissive.set( material.color ).multiplyScalar( luminance );\n\n\t\t\t}\n\n\t\t\tif ( ! edgeMaterial ) {\n\n\t\t\t\t// This is the material used for edges\n\t\t\t\tedgeMaterial = new THREE.LineBasicMaterial( {\n\t\t\t\t\tcolor: edgeColour,\n\t\t\t\t\ttransparent: isTransparent,\n\t\t\t\t\topacity: alpha,\n\t\t\t\t\tdepthWrite: ! isTransparent\n\t\t\t\t} );\n\t\t\t\tedgeMaterial.userData.code = code;\n\t\t\t\tedgeMaterial.name = name + \" - Edge\";\n\t\t\t\tedgeMaterial.userData.canHaveEnvMap = false;\n\n\t\t\t\t// This is the material used for conditional edges\n\t\t\t\tedgeMaterial.userData.conditionalEdgeMaterial = new THREE.ShaderMaterial( {\n\t\t\t\t\tvertexShader: conditionalLineVertShader,\n\t\t\t\t\tfragmentShader: conditionalLineFragShader,\n\t\t\t\t\tuniforms: {\n\t\t\t\t\t\tdiffuse: {\n\t\t\t\t\t\t\tvalue: new THREE.Color( edgeColour )\n\t\t\t\t\t\t},\n\t\t\t\t\t\topacity: {\n\t\t\t\t\t\t\tvalue: alpha\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\ttransparent: isTransparent,\n\t\t\t\t\tdepthWrite: ! isTransparent\n\t\t\t\t} );\n\t\t\t\tedgeMaterial.userData.conditionalEdgeMaterial.userData.canHaveEnvMap = false;\n\n\t\t\t}\n\n\t\t\tmaterial.userData.code = code;\n\t\t\tmaterial.name = name;\n\n\t\t\tmaterial.userData.edgeMaterial = edgeMaterial;\n\n\t\t\treturn material;\n\n\t\t},\n\n\t\t//\n\n\t\tobjectParse: function ( text ) {\n\n\t\t\t// Retrieve data from the parent parse scope\n\t\t\tvar parentParseScope = this.getParentParseScope();\n\n\t\t\t// Main colour codes passed to this subobject (or default codes 16 and 24 if it is the root object)\n\t\t\tvar mainColourCode = parentParseScope.mainColourCode;\n\t\t\tvar mainEdgeColourCode = parentParseScope.mainEdgeColourCode;\n\n\t\t\tvar currentParseScope = this.getCurrentParseScope();\n\n\t\t\t// Parse result variables\n\t\t\tvar triangles;\n\t\t\tvar lineSegments;\n\t\t\tvar conditionalSegments;\n\n\t\t\tvar subobjects = [];\n\n\t\t\tvar category = null;\n\t\t\tvar keywords = null;\n\n\t\t\tif ( text.indexOf( '\\r\\n' ) !== - 1 ) {\n\n\t\t\t\t// This is faster than String.split with regex that splits on both\n\t\t\t\ttext = text.replace( /\\r\\n/g, '\\n' );\n\n\t\t\t}\n\n\t\t\tvar lines = text.split( '\\n' );\n\t\t\tvar numLines = lines.length;\n\t\t\tvar lineIndex = 0;\n\n\t\t\tvar parsingEmbeddedFiles = false;\n\t\t\tvar currentEmbeddedFileName = null;\n\t\t\tvar currentEmbeddedText = null;\n\n\t\t\tvar bfcCertified = false;\n\t\t\tvar bfcCCW = true;\n\t\t\tvar bfcInverted = false;\n\t\t\tvar bfcCull = true;\n\t\t\tvar type = '';\n\n\t\t\tvar startingConstructionStep = false;\n\n\t\t\tvar scope = this;\n\t\t\tfunction parseColourCode( lineParser, forEdge ) {\n\n\t\t\t\t// Parses next colour code and returns a THREE.Material\n\n\t\t\t\tvar colourCode = lineParser.getToken();\n\n\t\t\t\tif ( ! forEdge && colourCode === '16' ) {\n\n\t\t\t\t\tcolourCode = mainColourCode;\n\n\t\t\t\t}\n\n\t\t\t\tif ( forEdge && colourCode === '24' ) {\n\n\t\t\t\t\tcolourCode = mainEdgeColourCode;\n\n\t\t\t\t}\n\n\t\t\t\tvar material = scope.getMaterial( colourCode );\n\n\t\t\t\tif ( ! material ) {\n\n\t\t\t\t\tthrow 'LDrawLoader: Unknown colour code \"' + colourCode + '\" is used' + lineParser.getLineNumberString() + ' but it was not defined previously.';\n\n\t\t\t\t}\n\n\t\t\t\treturn material;\n\n\t\t\t}\n\n\t\t\tfunction parseVector( lp ) {\n\n\t\t\t\tvar v = new THREE.Vector3( parseFloat( lp.getToken() ), parseFloat( lp.getToken() ), parseFloat( lp.getToken() ) );\n\n\t\t\t\tif ( ! scope.separateObjects ) {\n\n\t\t\t\t\tv.applyMatrix4( currentParseScope.currentMatrix );\n\n\t\t\t\t}\n\n\t\t\t\treturn v;\n\n\t\t\t}\n\n\t\t\t// Parse all line commands\n\t\t\tfor ( lineIndex = 0; lineIndex < numLines; lineIndex ++ ) {\n\n\t\t\t\tvar line = lines[ lineIndex ];\n\n\t\t\t\tif ( line.length === 0 ) continue;\n\n\t\t\t\tif ( parsingEmbeddedFiles ) {\n\n\t\t\t\t\tif ( line.startsWith( '0 FILE ' ) ) {\n\n\t\t\t\t\t\t// Save previous embedded file in the cache\n\t\t\t\t\t\tthis.subobjectCache[ currentEmbeddedFileName.toLowerCase() ] = currentEmbeddedText;\n\n\t\t\t\t\t\t// New embedded text file\n\t\t\t\t\t\tcurrentEmbeddedFileName = line.substring( 7 );\n\t\t\t\t\t\tcurrentEmbeddedText = '';\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tcurrentEmbeddedText += line + '\\n';\n\n\t\t\t\t\t}\n\n\t\t\t\t\tcontinue;\n\n\t\t\t\t}\n\n\t\t\t\tvar lp = new LineParser( line, lineIndex + 1 );\n\n\t\t\t\tlp.seekNonSpace();\n\n\t\t\t\tif ( lp.isAtTheEnd() ) {\n\n\t\t\t\t\t// Empty line\n\t\t\t\t\tcontinue;\n\n\t\t\t\t}\n\n\t\t\t\t// Parse the line type\n\t\t\t\tvar lineType = lp.getToken();\n\n\t\t\t\tswitch ( lineType ) {\n\n\t\t\t\t\t// Line type 0: Comment or META\n\t\t\t\t\tcase '0':\n\n\t\t\t\t\t\t// Parse meta directive\n\t\t\t\t\t\tvar meta = lp.getToken();\n\n\t\t\t\t\t\tif ( meta ) {\n\n\t\t\t\t\t\t\tswitch ( meta ) {\n\n\t\t\t\t\t\t\t\tcase '!LDRAW_ORG':\n\n\t\t\t\t\t\t\t\t\ttype = lp.getToken();\n\n\t\t\t\t\t\t\t\t\tcurrentParseScope.triangles = [];\n\t\t\t\t\t\t\t\t\tcurrentParseScope.lineSegments = [];\n\t\t\t\t\t\t\t\t\tcurrentParseScope.conditionalSegments = [];\n\t\t\t\t\t\t\t\t\tcurrentParseScope.type = type;\n\n\t\t\t\t\t\t\t\t\tvar isRoot = ! parentParseScope.isFromParse;\n\t\t\t\t\t\t\t\t\tif ( isRoot || scope.separateObjects && ! isPrimitiveType( type ) ) {\n\n\t\t\t\t\t\t\t\t\t\tcurrentParseScope.groupObject = new THREE.Group();\n\n\t\t\t\t\t\t\t\t\t\tcurrentParseScope.groupObject.userData.startingConstructionStep = currentParseScope.startingConstructionStep;\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// If the scale of the object is negated then the triangle winding order\n\t\t\t\t\t\t\t\t\t// needs to be flipped.\n\t\t\t\t\t\t\t\t\tvar matrix = currentParseScope.matrix;\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\tmatrix.determinant() < 0 && (\n\t\t\t\t\t\t\t\t\t\t\tscope.separateObjects && isPrimitiveType( type ) ||\n\t\t\t\t\t\t\t\t\t\t\t! scope.separateObjects\n\t\t\t\t\t\t\t\t\t\t) ) {\n\n\t\t\t\t\t\t\t\t\t\tcurrentParseScope.inverted = ! currentParseScope.inverted;\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\ttriangles = currentParseScope.triangles;\n\t\t\t\t\t\t\t\t\tlineSegments = currentParseScope.lineSegments;\n\t\t\t\t\t\t\t\t\tconditionalSegments = currentParseScope.conditionalSegments;\n\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase '!COLOUR':\n\n\t\t\t\t\t\t\t\t\tvar material = this.parseColourMetaDirective( lp );\n\t\t\t\t\t\t\t\t\tif ( material ) {\n\n\t\t\t\t\t\t\t\t\t\tthis.addMaterial( material );\n\n\t\t\t\t\t\t\t\t\t}\telse {\n\n\t\t\t\t\t\t\t\t\t\tconsole.warn( 'LDrawLoader: Error parsing material' + lp.getLineNumberString() );\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase '!CATEGORY':\n\n\t\t\t\t\t\t\t\t\tcategory = lp.getToken();\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase '!KEYWORDS':\n\n\t\t\t\t\t\t\t\t\tvar newKeywords = lp.getRemainingString().split( ',' );\n\t\t\t\t\t\t\t\t\tif ( newKeywords.length > 0 ) {\n\n\t\t\t\t\t\t\t\t\t\tif ( ! keywords ) {\n\n\t\t\t\t\t\t\t\t\t\t\tkeywords = [];\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tnewKeywords.forEach( function ( keyword ) {\n\n\t\t\t\t\t\t\t\t\t\t\tkeywords.push( keyword.trim() );\n\n\t\t\t\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 'FILE':\n\n\t\t\t\t\t\t\t\t\tif ( lineIndex > 0 ) {\n\n\t\t\t\t\t\t\t\t\t\t// Start embedded text files parsing\n\t\t\t\t\t\t\t\t\t\tparsingEmbeddedFiles = true;\n\t\t\t\t\t\t\t\t\t\tcurrentEmbeddedFileName = lp.getRemainingString();\n\t\t\t\t\t\t\t\t\t\tcurrentEmbeddedText = '';\n\n\t\t\t\t\t\t\t\t\t\tbfcCertified = false;\n\t\t\t\t\t\t\t\t\t\tbfcCCW = true;\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 'BFC':\n\n\t\t\t\t\t\t\t\t\t// Changes to the backface culling state\n\t\t\t\t\t\t\t\t\twhile ( ! lp.isAtTheEnd() ) {\n\n\t\t\t\t\t\t\t\t\t\tvar token = lp.getToken();\n\n\t\t\t\t\t\t\t\t\t\tswitch ( token ) {\n\n\t\t\t\t\t\t\t\t\t\t\tcase 'CERTIFY':\n\t\t\t\t\t\t\t\t\t\t\tcase 'NOCERTIFY':\n\n\t\t\t\t\t\t\t\t\t\t\t\tbfcCertified = token === 'CERTIFY';\n\t\t\t\t\t\t\t\t\t\t\t\tbfcCCW = true;\n\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\tcase 'CW':\n\t\t\t\t\t\t\t\t\t\t\tcase 'CCW':\n\n\t\t\t\t\t\t\t\t\t\t\t\tbfcCCW = token === 'CCW';\n\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\tcase 'INVERTNEXT':\n\n\t\t\t\t\t\t\t\t\t\t\t\tbfcInverted = true;\n\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\tcase 'CLIP':\n\t\t\t\t\t\t\t\t\t\t\tcase 'NOCLIP':\n\n\t\t\t\t\t\t\t\t\t\t\t  bfcCull = token === 'CLIP';\n\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\tdefault:\n\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.warn( 'THREE.LDrawLoader: BFC directive \"' + token + '\" is unknown.' );\n\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 'STEP':\n\n\t\t\t\t\t\t\t\t\tstartingConstructionStep = true;\n\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t// Other meta directives are not implemented\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t// Line type 1: Sub-object file\n\t\t\t\t\tcase '1':\n\n\t\t\t\t\t\tvar material = parseColourCode( lp );\n\n\t\t\t\t\t\tvar posX = parseFloat( lp.getToken() );\n\t\t\t\t\t\tvar posY = parseFloat( lp.getToken() );\n\t\t\t\t\t\tvar posZ = parseFloat( lp.getToken() );\n\t\t\t\t\t\tvar m0 = parseFloat( lp.getToken() );\n\t\t\t\t\t\tvar m1 = parseFloat( lp.getToken() );\n\t\t\t\t\t\tvar m2 = parseFloat( lp.getToken() );\n\t\t\t\t\t\tvar m3 = parseFloat( lp.getToken() );\n\t\t\t\t\t\tvar m4 = parseFloat( lp.getToken() );\n\t\t\t\t\t\tvar m5 = parseFloat( lp.getToken() );\n\t\t\t\t\t\tvar m6 = parseFloat( lp.getToken() );\n\t\t\t\t\t\tvar m7 = parseFloat( lp.getToken() );\n\t\t\t\t\t\tvar m8 = parseFloat( lp.getToken() );\n\n\t\t\t\t\t\tvar matrix = new THREE.Matrix4().set(\n\t\t\t\t\t\t\tm0, m1, m2, posX,\n\t\t\t\t\t\t\tm3, m4, m5, posY,\n\t\t\t\t\t\t\tm6, m7, m8, posZ,\n\t\t\t\t\t\t\t0, 0, 0, 1\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tvar fileName = lp.getRemainingString().trim().replace( /\\\\/g, \"/\" );\n\n\t\t\t\t\t\tif ( scope.fileMap[ fileName ] ) {\n\n\t\t\t\t\t\t\t// Found the subobject path in the preloaded file path map\n\t\t\t\t\t\t\tfileName = scope.fileMap[ fileName ];\n\n\t\t\t\t\t\t}\telse {\n\n\t\t\t\t\t\t\t// Standardized subfolders\n\t\t\t\t\t\t\tif ( fileName.startsWith( 's/' ) ) {\n\n\t\t\t\t\t\t\t\tfileName = 'parts/' + fileName;\n\n\t\t\t\t\t\t\t} else if ( fileName.startsWith( '48/' ) ) {\n\n\t\t\t\t\t\t\t\tfileName = 'p/' + fileName;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsubobjects.push( {\n\t\t\t\t\t\t\tmaterial: material,\n\t\t\t\t\t\t\tmatrix: matrix,\n\t\t\t\t\t\t\tfileName: fileName,\n\t\t\t\t\t\t\toriginalFileName: fileName,\n\t\t\t\t\t\t\tlocationState: LDrawLoader.FILE_LOCATION_AS_IS,\n\t\t\t\t\t\t\turl: null,\n\t\t\t\t\t\t\ttriedLowerCase: false,\n\t\t\t\t\t\t\tinverted: bfcInverted !== currentParseScope.inverted,\n\t\t\t\t\t\t\tstartingConstructionStep: startingConstructionStep\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tbfcInverted = false;\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t// Line type 2: Line segment\n\t\t\t\t\tcase '2':\n\n\t\t\t\t\t\tvar material = parseColourCode( lp, true );\n\n\t\t\t\t\t\tvar segment = {\n\t\t\t\t\t\t\tmaterial: material.userData.edgeMaterial,\n\t\t\t\t\t\t\tcolourCode: material.userData.code,\n\t\t\t\t\t\t\tv0: parseVector( lp ),\n\t\t\t\t\t\t\tv1: parseVector( lp )\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tlineSegments.push( segment );\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t// Line type 5: Conditional Line segment\n\t\t\t\t\tcase '5':\n\n\t\t\t\t\t\tvar material = parseColourCode( lp, true );\n\n\t\t\t\t\t\tvar segment = {\n\t\t\t\t\t\t\tmaterial: material.userData.edgeMaterial.userData.conditionalEdgeMaterial,\n\t\t\t\t\t\t\tcolourCode: material.userData.code,\n\t\t\t\t\t\t\tv0: parseVector( lp ),\n\t\t\t\t\t\t\tv1: parseVector( lp ),\n\t\t\t\t\t\t\tc0: parseVector( lp ),\n\t\t\t\t\t\t\tc1: parseVector( lp )\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tconditionalSegments.push( segment );\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t// Line type 3: Triangle\n\t\t\t\t\tcase '3':\n\n\t\t\t\t\t\tvar material = parseColourCode( lp );\n\n\t\t\t\t\t\tvar inverted = currentParseScope.inverted;\n\t\t\t\t\t\tvar ccw = bfcCCW !== inverted;\n\t\t\t\t\t\tvar doubleSided = ! bfcCertified || ! bfcCull;\n\t\t\t\t\t\tvar v0, v1, v2, faceNormal;\n\n\t\t\t\t\t\tif ( ccw === true ) {\n\n\t\t\t\t\t\t\tv0 = parseVector( lp );\n\t\t\t\t\t\t\tv1 = parseVector( lp );\n\t\t\t\t\t\t\tv2 = parseVector( lp );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tv2 = parseVector( lp );\n\t\t\t\t\t\t\tv1 = parseVector( lp );\n\t\t\t\t\t\t\tv0 = parseVector( lp );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttempVec0.subVectors( v1, v0 );\n\t\t\t\t\t\ttempVec1.subVectors( v2, v1 );\n\t\t\t\t\t\tfaceNormal = new THREE.Vector3()\n\t\t\t\t\t\t\t.crossVectors( tempVec0, tempVec1 )\n\t\t\t\t\t\t\t.normalize();\n\n\t\t\t\t\t\ttriangles.push( {\n\t\t\t\t\t\t\tmaterial: material,\n\t\t\t\t\t\t\tcolourCode: material.userData.code,\n\t\t\t\t\t\t\tv0: v0,\n\t\t\t\t\t\t\tv1: v1,\n\t\t\t\t\t\t\tv2: v2,\n\t\t\t\t\t\t\tfaceNormal: faceNormal,\n\t\t\t\t\t\t\tn0: null,\n\t\t\t\t\t\t\tn1: null,\n\t\t\t\t\t\t\tn2: null\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tif ( doubleSided === true ) {\n\n\t\t\t\t\t\t\ttriangles.push( {\n\t\t\t\t\t\t\t\tmaterial: material,\n\t\t\t\t\t\t\t\tcolourCode: material.userData.code,\n\t\t\t\t\t\t\t\tv0: v0,\n\t\t\t\t\t\t\t\tv1: v2,\n\t\t\t\t\t\t\t\tv2: v1,\n\t\t\t\t\t\t\t\tfaceNormal: faceNormal,\n\t\t\t\t\t\t\t\tn0: null,\n\t\t\t\t\t\t\t\tn1: null,\n\t\t\t\t\t\t\t\tn2: null\n\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t// Line type 4: Quadrilateral\n\t\t\t\t\tcase '4':\n\n\t\t\t\t\t\tvar material = parseColourCode( lp );\n\n\t\t\t\t\t\tvar inverted = currentParseScope.inverted;\n\t\t\t\t\t\tvar ccw = bfcCCW !== inverted;\n\t\t\t\t\t\tvar doubleSided = ! bfcCertified || ! bfcCull;\n\t\t\t\t\t\tvar v0, v1, v2, v3, faceNormal;\n\n\t\t\t\t\t\tif ( ccw === true ) {\n\n\t\t\t\t\t\t\tv0 = parseVector( lp );\n\t\t\t\t\t\t\tv1 = parseVector( lp );\n\t\t\t\t\t\t\tv2 = parseVector( lp );\n\t\t\t\t\t\t\tv3 = parseVector( lp );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tv3 = parseVector( lp );\n\t\t\t\t\t\t\tv2 = parseVector( lp );\n\t\t\t\t\t\t\tv1 = parseVector( lp );\n\t\t\t\t\t\t\tv0 = parseVector( lp );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttempVec0.subVectors( v1, v0 );\n\t\t\t\t\t\ttempVec1.subVectors( v2, v1 );\n\t\t\t\t\t\tfaceNormal = new THREE.Vector3()\n\t\t\t\t\t\t\t.crossVectors( tempVec0, tempVec1 )\n\t\t\t\t\t\t\t.normalize();\n\n\t\t\t\t\t\ttriangles.push( {\n\t\t\t\t\t\t\tmaterial: material,\n\t\t\t\t\t\t\tcolourCode: material.userData.code,\n\t\t\t\t\t\t\tv0: v0,\n\t\t\t\t\t\t\tv1: v1,\n\t\t\t\t\t\t\tv2: v2,\n\t\t\t\t\t\t\tfaceNormal: faceNormal,\n\t\t\t\t\t\t\tn0: null,\n\t\t\t\t\t\t\tn1: null,\n\t\t\t\t\t\t\tn2: null\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\ttriangles.push( {\n\t\t\t\t\t\t\tmaterial: material,\n\t\t\t\t\t\t\tcolourCode: material.userData.code,\n\t\t\t\t\t\t\tv0: v0,\n\t\t\t\t\t\t\tv1: v2,\n\t\t\t\t\t\t\tv2: v3,\n\t\t\t\t\t\t\tfaceNormal: faceNormal,\n\t\t\t\t\t\t\tn0: null,\n\t\t\t\t\t\t\tn1: null,\n\t\t\t\t\t\t\tn2: null\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tif ( doubleSided === true ) {\n\n\t\t\t\t\t\t\ttriangles.push( {\n\t\t\t\t\t\t\t\tmaterial: material,\n\t\t\t\t\t\t\t\tcolourCode: material.userData.code,\n\t\t\t\t\t\t\t\tv0: v0,\n\t\t\t\t\t\t\t\tv1: v2,\n\t\t\t\t\t\t\t\tv2: v1,\n\t\t\t\t\t\t\t\tfaceNormal: faceNormal,\n\t\t\t\t\t\t\t\tn0: null,\n\t\t\t\t\t\t\t\tn1: null,\n\t\t\t\t\t\t\t\tn2: null\n\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\ttriangles.push( {\n\t\t\t\t\t\t\t\tmaterial: material,\n\t\t\t\t\t\t\t\tcolourCode: material.userData.code,\n\t\t\t\t\t\t\t\tv0: v0,\n\t\t\t\t\t\t\t\tv1: v3,\n\t\t\t\t\t\t\t\tv2: v2,\n\t\t\t\t\t\t\t\tfaceNormal: faceNormal,\n\t\t\t\t\t\t\t\tn0: null,\n\t\t\t\t\t\t\t\tn1: null,\n\t\t\t\t\t\t\t\tn2: null\n\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthrow 'LDrawLoader: Unknown line type \"' + lineType + '\"' + lp.getLineNumberString() + '.';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( parsingEmbeddedFiles ) {\n\n\t\t\t\tthis.subobjectCache[ currentEmbeddedFileName.toLowerCase() ] = currentEmbeddedText;\n\n\t\t\t}\n\n\t\t\tcurrentParseScope.category = category;\n\t\t\tcurrentParseScope.keywords = keywords;\n\t\t\tcurrentParseScope.subobjects = subobjects;\n\t\t\tcurrentParseScope.numSubobjects = subobjects.length;\n\t\t\tcurrentParseScope.subobjectIndex = 0;\n\n\t\t},\n\n\t\tcomputeConstructionSteps: function ( model ) {\n\n\t\t\t// Sets userdata.constructionStep number in Group objects and userData.numConstructionSteps number in the root Group object.\n\n\t\t\tvar stepNumber = 0;\n\n\t\t\tmodel.traverse( c => {\n\n\t\t\t\tif ( c.isGroup ) {\n\n\t\t\t\t\tif ( c.userData.startingConstructionStep ) {\n\n\t\t\t\t\t\tstepNumber ++;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tc.userData.constructionStep = stepNumber;\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\tmodel.userData.numConstructionSteps = stepNumber + 1;\n\n\t\t},\n\n\t\tprocessObject: function ( text, onProcessed, subobject, url ) {\n\n\t\t\tvar scope = this;\n\n\t\t\tvar parseScope = scope.newParseScopeLevel();\n\t\t\tparseScope.url = url;\n\n\t\t\tvar parentParseScope = scope.getParentParseScope();\n\n\t\t\t// Set current matrix\n\t\t\tif ( subobject ) {\n\n\t\t\t\tparseScope.currentMatrix.multiplyMatrices( parentParseScope.currentMatrix, subobject.matrix );\n\t\t\t\tparseScope.matrix.copy( subobject.matrix );\n\t\t\t\tparseScope.inverted = subobject.inverted;\n\t\t\t\tparseScope.startingConstructionStep = subobject.startingConstructionStep;\n\n\t\t\t}\n\n\t\t\t// Add to cache\n\t\t\tvar currentFileName = parentParseScope.currentFileName;\n\t\t\tif ( currentFileName !== null ) {\n\n\t\t\t\tcurrentFileName = parentParseScope.currentFileName.toLowerCase();\n\n\t\t\t}\n\n\t\t\tif ( scope.subobjectCache[ currentFileName ] === undefined ) {\n\n\t\t\t\tscope.subobjectCache[ currentFileName ] = text;\n\n\t\t\t}\n\n\n\t\t\t// Parse the object (returns a THREE.Group)\n\t\t\tscope.objectParse( text );\n\t\t\tvar finishedCount = 0;\n\t\t\tonSubobjectFinish();\n\n\t\t\tfunction onSubobjectFinish() {\n\n\t\t\t\tfinishedCount ++;\n\n\t\t\t\tif ( finishedCount === parseScope.subobjects.length + 1 ) {\n\n\t\t\t\t\tfinalizeObject();\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Once the previous subobject has finished we can start processing the next one in the list.\n\t\t\t\t\t// The subobject processing shares scope in processing so it's important that they be loaded serially\n\t\t\t\t\t// to avoid race conditions.\n\t\t\t\t\t// Promise.resolve is used as an approach to asynchronously schedule a task _before_ this frame ends to\n\t\t\t\t\t// avoid stack overflow exceptions when loading many subobjects from the cache. RequestAnimationFrame\n\t\t\t\t\t// will work but causes the load to happen after the next frame which causes the load to take significantly longer.\n\t\t\t\t\tvar subobject = parseScope.subobjects[ parseScope.subobjectIndex ];\n\t\t\t\t\tPromise.resolve().then( function () {\n\n\t\t\t\t\t\tloadSubobject( subobject );\n\n\t\t\t\t\t} );\n\t\t\t\t\tparseScope.subobjectIndex ++;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tfunction finalizeObject() {\n\n\t\t\t\tif ( scope.smoothNormals && parseScope.type === 'Part' ) {\n\n\t\t\t\t\tsmoothNormals( parseScope.triangles, parseScope.lineSegments );\n\n\t\t\t\t}\n\n\t\t\t\tvar isRoot = ! parentParseScope.isFromParse;\n\t\t\t\tif ( scope.separateObjects && ! isPrimitiveType( parseScope.type ) || isRoot ) {\n\n\t\t\t\t\tconst objGroup = parseScope.groupObject;\n\n\t\t\t\t\tif ( parseScope.triangles.length > 0 ) {\n\n\t\t\t\t\t\tobjGroup.add( createObject( parseScope.triangles, 3 ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( parseScope.lineSegments.length > 0 ) {\n\n\t\t\t\t\t\tobjGroup.add( createObject( parseScope.lineSegments, 2 ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( parseScope.conditionalSegments.length > 0 ) {\n\n\t\t\t\t\t\tobjGroup.add( createObject( parseScope.conditionalSegments, 2, true ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( parentParseScope.groupObject ) {\n\n\t\t\t\t\t\tobjGroup.name = parseScope.fileName;\n\t\t\t\t\t\tobjGroup.userData.category = parseScope.category;\n\t\t\t\t\t\tobjGroup.userData.keywords = parseScope.keywords;\n\t\t\t\t\t\tparseScope.matrix.decompose( objGroup.position, objGroup.quaternion, objGroup.scale );\n\n\t\t\t\t\t\tparentParseScope.groupObject.add( objGroup );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tvar separateObjects = scope.separateObjects;\n\t\t\t\t\tvar parentLineSegments = parentParseScope.lineSegments;\n\t\t\t\t\tvar parentConditionalSegments = parentParseScope.conditionalSegments;\n\t\t\t\t\tvar parentTriangles = parentParseScope.triangles;\n\n\t\t\t\t\tvar lineSegments = parseScope.lineSegments;\n\t\t\t\t\tvar conditionalSegments = parseScope.conditionalSegments;\n\t\t\t\t\tvar triangles = parseScope.triangles;\n\n\t\t\t\t\tfor ( var i = 0, l = lineSegments.length; i < l; i ++ ) {\n\n\t\t\t\t\t\tvar ls = lineSegments[ i ];\n\n\t\t\t\t\t\tif ( separateObjects ) {\n\n\t\t\t\t\t\t\tls.v0.applyMatrix4( parseScope.matrix );\n\t\t\t\t\t\t\tls.v1.applyMatrix4( parseScope.matrix );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tparentLineSegments.push( ls );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfor ( var i = 0, l = conditionalSegments.length; i < l; i ++ ) {\n\n\t\t\t\t\t\tvar os = conditionalSegments[ i ];\n\n\t\t\t\t\t\tif ( separateObjects ) {\n\n\t\t\t\t\t\t\tos.v0.applyMatrix4( parseScope.matrix );\n\t\t\t\t\t\t\tos.v1.applyMatrix4( parseScope.matrix );\n\t\t\t\t\t\t\tos.c0.applyMatrix4( parseScope.matrix );\n\t\t\t\t\t\t\tos.c1.applyMatrix4( parseScope.matrix );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tparentConditionalSegments.push( os );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfor ( var i = 0, l = triangles.length; i < l; i ++ ) {\n\n\t\t\t\t\t\tvar tri = triangles[ i ];\n\n\t\t\t\t\t\tif ( separateObjects ) {\n\n\t\t\t\t\t\t\ttri.v0 = tri.v0.clone().applyMatrix4( parseScope.matrix );\n\t\t\t\t\t\t\ttri.v1 = tri.v1.clone().applyMatrix4( parseScope.matrix );\n\t\t\t\t\t\t\ttri.v2 = tri.v2.clone().applyMatrix4( parseScope.matrix );\n\n\t\t\t\t\t\t\ttempVec0.subVectors( tri.v1, tri.v0 );\n\t\t\t\t\t\t\ttempVec1.subVectors( tri.v2, tri.v1 );\n\t\t\t\t\t\t\ttri.faceNormal.crossVectors( tempVec0, tempVec1 ).normalize();\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tparentTriangles.push( tri );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tscope.removeScopeLevel();\n\n\t\t\t\t// If it is root object, compute construction steps\n\t\t\t\tif ( ! parentParseScope.isFromParse ) {\n\n\t\t\t\t\tscope.computeConstructionSteps( parseScope.groupObject );\n\n\t\t\t\t}\n\n\t\t\t\tif ( onProcessed ) {\n\n\t\t\t\t\tonProcessed( parseScope.groupObject );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tfunction loadSubobject( subobject ) {\n\n\t\t\t\tparseScope.mainColourCode = subobject.material.userData.code;\n\t\t\t\tparseScope.mainEdgeColourCode = subobject.material.userData.edgeMaterial.userData.code;\n\t\t\t\tparseScope.currentFileName = subobject.originalFileName;\n\n\n\t\t\t\t// If subobject was cached previously, use the cached one\n\t\t\t\tvar cached = scope.subobjectCache[ subobject.originalFileName.toLowerCase() ];\n\t\t\t\tif ( cached ) {\n\n\t\t\t\t\tscope.processObject( cached, function ( subobjectGroup ) {\n\n\t\t\t\t\t\tonSubobjectLoaded( subobjectGroup, subobject );\n\t\t\t\t\t\tonSubobjectFinish();\n\n\t\t\t\t\t}, subobject, url );\n\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t\t// Adjust file name to locate the subobject file path in standard locations (always under directory scope.path)\n\t\t\t\t// Update also subobject.locationState for the next try if this load fails.\n\t\t\t\tvar subobjectURL = subobject.fileName;\n\t\t\t\tvar newLocationState = LDrawLoader.FILE_LOCATION_NOT_FOUND;\n\n\t\t\t\tswitch ( subobject.locationState ) {\n\n\t\t\t\t\tcase LDrawLoader.FILE_LOCATION_AS_IS:\n\t\t\t\t\t\tnewLocationState = subobject.locationState + 1;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase LDrawLoader.FILE_LOCATION_TRY_PARTS:\n\t\t\t\t\t\tsubobjectURL = 'parts/' + subobjectURL;\n\t\t\t\t\t\tnewLocationState = subobject.locationState + 1;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase LDrawLoader.FILE_LOCATION_TRY_P:\n\t\t\t\t\t\tsubobjectURL = 'p/' + subobjectURL;\n\t\t\t\t\t\tnewLocationState = subobject.locationState + 1;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase LDrawLoader.FILE_LOCATION_TRY_MODELS:\n\t\t\t\t\t\tsubobjectURL = 'models/' + subobjectURL;\n\t\t\t\t\t\tnewLocationState = subobject.locationState + 1;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase LDrawLoader.FILE_LOCATION_TRY_RELATIVE:\n\t\t\t\t\t\tsubobjectURL = url.substring( 0, url.lastIndexOf( \"/\" ) + 1 ) + subobjectURL;\n\t\t\t\t\t\tnewLocationState = subobject.locationState + 1;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase LDrawLoader.FILE_LOCATION_TRY_ABSOLUTE:\n\n\t\t\t\t\t\tif ( subobject.triedLowerCase ) {\n\n\t\t\t\t\t\t\t// Try absolute path\n\t\t\t\t\t\t\tnewLocationState = LDrawLoader.FILE_LOCATION_NOT_FOUND;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t// Next attempt is lower case\n\t\t\t\t\t\t\tsubobject.fileName = subobject.fileName.toLowerCase();\n\t\t\t\t\t\t\tsubobjectURL = subobject.fileName;\n\t\t\t\t\t\t\tsubobject.triedLowerCase = true;\n\t\t\t\t\t\t\tnewLocationState = LDrawLoader.FILE_LOCATION_AS_IS;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase LDrawLoader.FILE_LOCATION_NOT_FOUND:\n\n\t\t\t\t\t\t// All location possibilities have been tried, give up loading this object\n\t\t\t\t\t\tconsole.warn( 'LDrawLoader: Subobject \"' + subobject.originalFileName + '\" could not be found.' );\n\n\t\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t\tsubobject.locationState = newLocationState;\n\t\t\t\tsubobject.url = subobjectURL;\n\n\t\t\t\t// Load the subobject\n\t\t\t\t// Use another file loader here so we can keep track of the subobject information\n\t\t\t\t// and use it when processing the next model.\n\t\t\t\tvar fileLoader = new THREE.FileLoader( scope.manager );\n\t\t\t\tfileLoader.setPath( scope.path );\n\t\t\t\tfileLoader.setRequestHeader( scope.requestHeader );\n\t\t\t\tfileLoader.setWithCredentials( scope.withCredentials );\n\t\t\t\tfileLoader.load( subobjectURL, function ( text ) {\n\n\t\t\t\t\tscope.processObject( text, function ( subobjectGroup ) {\n\n\t\t\t\t\t\tonSubobjectLoaded( subobjectGroup, subobject );\n\t\t\t\t\t\tonSubobjectFinish();\n\n\t\t\t\t\t}, subobject, url );\n\n\t\t\t\t}, undefined, function ( err ) {\n\n\t\t\t\t\tonSubobjectError( err, subobject );\n\n\t\t\t\t}, subobject );\n\n\t\t\t}\n\n\t\t\tfunction onSubobjectLoaded( subobjectGroup, subobject ) {\n\n\t\t\t\tif ( subobjectGroup === null ) {\n\n\t\t\t\t\t// Try to reload\n\t\t\t\t\tloadSubobject( subobject );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t\tscope.fileMap[ subobject.originalFileName ] = subobject.url;\n\n\t\t\t}\n\n\t\t\tfunction onSubobjectError( err, subobject ) {\n\n\t\t\t\t// Retry download from a different default possible location\n\t\t\t\tloadSubobject( subobject );\n\n\t\t\t}\n\n\t\t}\n\n\t} );\n\n\treturn LDrawLoader;\n\n} )();\n"]}